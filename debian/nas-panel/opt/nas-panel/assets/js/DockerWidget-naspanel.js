import{_ as q,u as K,r as v,c as h,o as M,W as $,b as A,A as N,B as y,h as G,e as l,w as k,f as n,d as f,g as c,k as a,I as d,t as r,m as T,F as H,l as J,n as Q,E as w}from"./index-naspanel.js";const X={class:"widget-header"},Y={class:"header-main"},Z={class:"header-icon"},tt={class:"header-title"},st={class:"update-time"},et={class:"header-sub"},ot={class:"widget-content"},nt={key:0,class:"offline-state"},at={class:"offline-icon"},rt={class:"offline-text"},it={key:1},ct={class:"stats-row"},lt={class:"stat-item"},dt={class:"stat-count"},ut={class:"stat-label"},mt={class:"stat-item"},ft={class:"stat-count"},gt={class:"stat-label"},pt={class:"stat-item"},_t={class:"stat-count"},vt={class:"stat-label"},ht={key:0,class:"containers-list"},kt={class:"container-left"},wt={class:"container-info"},yt={class:"container-name"},St={class:"container-status"},Ct={class:"container-right"},bt={key:1,class:"no-containers"},Dt={name:"DockerWidget",displayName:"Kontenery Docker"},It=Object.assign(Dt,{setup(Et){const{t:s}=K(),g=v([]),S=v(!1),_=v("unknown"),C=v(!1),b=v(s("common.loading"));let D=null;const U=h(function(){return _.value==="active"}),B=h(function(){return{active:"success",inactive:"danger",error:"warning",unknown:"info"}[_.value]||"info"}),R=h(function(){return{active:s("docker.status.running"),inactive:s("docker.status.stopped"),error:s("docker.status.error"),unknown:s("docker.status.unknown")}[_.value]||s("docker.status.unknown")}),L=h(function(){return g.value.filter(function(t){return p(t)}).length}),W=h(function(){return g.value.filter(function(t){return!p(t)}).length});function p(t){if(!t)return!1;const e=String(t.Status||t.status||"").toLowerCase().trim(),i=String(t.state||"").toLowerCase().trim();return e.startsWith("up")||i==="running"||e.includes("running")}function j(t){const e=t.Image||"";return e.includes("nginx")?"mdi:nginx":e.includes("mysql")||e.includes("mariadb")?"mdi:database":e.includes("redis")?"mdi:redis":e.includes("postgres")?"mdi:postgresql":e.includes("mongo")?"mdi:mongodb":e.includes("node")?"mdi:nodejs":e.includes("wordpress")?"mdi:wordpress":p(t)?"mdi:cube-outline":"mdi:cube-off-outline"}function z(t){return p(t)?"running":"stopped"}function F(t){const e=t.Status||t.status||"",i=String(e).toLowerCase();return i.startsWith("up")?s("docker.status.running"):i.includes("exited")||i.includes("stopped")?s("docker.status.stopped"):e||s("docker.status.unknown")}function I(t){return t?typeof t=="string"?t.replace(/^\//,""):Array.isArray(t)?(t[0]||"").replace(/^\//,""):String(t):"Unknown"}async function E(){try{S.value=!0;const t=window.location.protocol+"//"+window.location.hostname+":1112",[e,i]=await Promise.allSettled([fetch(t+"/services/docker/status"),fetch(t+"/services/docker/containers?all=false")]);if(e.status==="fulfilled"&&e.value.ok){const o=await e.value.json();_.value=o.status||"unknown"}else _.value="inactive";let u=[];if(i.status==="fulfilled"&&i.value.ok)try{const o=await i.value.json();Array.isArray(o)?u=o:o.containers&&Array.isArray(o.containers)?u=o.containers:o.data&&Array.isArray(o.data)&&(u=o.data)}catch(o){console.warn("Error parsing containers response:",o)}g.value=u.map(function(o){return{id:o.ID||o.Id||o.ContainerID||o.containerID,names:o.Names||o.Name||o.names,Status:o.Status,status:o.status,state:o.State||o.state,Image:o.Image||o.image,loading:!1}}),b.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(t){console.error("Error fetching Docker data:",t),b.value=s("common.error"),_.value="inactive",g.value=[],w.error({title:s("common.error"),message:s("docker.messages.fetchContainersError"),duration:3e3})}finally{S.value=!1}}async function O(){try{C.value=!0;const t=window.location.protocol+"//"+window.location.hostname+":1112";if(!(await fetch(t+"/services/docker/start",{method:"POST"})).ok)throw new Error("Failed to start Docker");w.success({title:s("common.success"),message:s("docker.messages.dockerStarted"),duration:3e3}),await E()}catch(t){console.error("Error starting Docker:",t),w.error({title:s("common.error"),message:s("docker.messages.dockerStartError"),duration:3e3})}finally{C.value=!1}}async function P(t){try{t.loading=!0;const e=p(t),i=e?"stop":"start",u=window.location.protocol+"//"+window.location.hostname+":1112";if(!(await fetch(u+"/services/docker/container/"+t.id+"/"+i,{method:"POST"})).ok)throw new Error("Failed to "+i+" container");e?t.Status="Exited":t.Status="Up 0 seconds",w.success({title:s("common.success"),message:e?s("docker.messages.containerStopped",{name:I(t.names)}):s("docker.messages.containerStarted",{name:I(t.names)}),duration:3e3})}catch(e){console.error("Error toggling container:",e),w.error({title:s("common.error"),message:s("docker.messages.containerToggleError"),duration:3e3})}finally{t.loading=!1}}return M(function(){E(),D=setInterval(E,3e4)}),$(function(){D&&clearInterval(D)}),(t,e)=>{const i=A("el-tag"),u=A("el-button"),o=A("el-card"),x=N("tooltip"),V=N("loading");return y((l(),G(o,{class:"widget-card",shadow:"hover"},{header:k(()=>[n("div",X,[n("div",Y,[n("div",Z,[c(a(d),{icon:"mdi:docker",width:"16"})]),n("span",tt,r(a(s)("widgets.Docker")),1),n("div",st,[c(a(d),{icon:"mdi:update",width:"12"}),n("span",null,r(a(s)("common.update"))+": "+r(b.value),1)])]),n("div",et,[c(i,{type:B.value,size:"small",class:"status-tag"},{default:k(()=>[e[0]||(e[0]=n("span",{class:"status-dot"},null,-1)),T(" "+r(R.value),1)]),_:1,__:[0]},8,["type"])])])]),default:k(()=>[n("div",ot,[U.value?(l(),f("div",it,[n("div",ct,[y((l(),f("div",lt,[c(a(d),{icon:"mdi:play-circle-outline",class:"stat-icon running",width:"18"}),n("span",dt,r(L.value),1),n("span",ut,r(a(s)("common.running")),1)])),[[x,a(s)("docker.stats.running")]]),y((l(),f("div",mt,[c(a(d),{icon:"mdi:stop-circle-outline",class:"stat-icon stopped",width:"18"}),n("span",ft,r(W.value),1),n("span",gt,r(a(s)("common.stopped")),1)])),[[x,a(s)("docker.stats.stopped")]]),y((l(),f("div",pt,[c(a(d),{icon:"mdi:cube-outline",class:"stat-icon total",width:"18"}),n("span",_t,r(g.value.length),1),n("span",vt,r(a(s)("common.total")),1)])),[[x,a(s)("docker.stats.total")]])]),g.value.length>0?(l(),f("div",ht,[(l(!0),f(H,null,J(g.value,m=>(l(),f("div",{key:m.id,class:"container-item"},[n("div",kt,[n("div",{class:Q(["container-icon",z(m)])},[c(a(d),{icon:j(m),width:"16"},null,8,["icon"])],2),n("div",wt,[n("div",yt,r(I(m.names)),1),n("div",St,r(F(m)),1)])]),n("div",Ct,[c(u,{size:"small",type:p(m)?"danger":"success",loading:m.loading,onClick:xt=>P(m),class:"action-btn",circle:""},{default:k(()=>[c(a(d),{icon:p(m)?"mdi:stop":"mdi:play",width:"14"},null,8,["icon"])]),_:2},1032,["type","loading","onClick"])])]))),128))])):(l(),f("div",bt,[c(a(d),{icon:"mdi:package-variant",width:"24"}),n("span",null,r(a(s)("docker.messages.noContainers")),1)]))])):(l(),f("div",nt,[n("div",at,[c(a(d),{icon:"mdi:docker-off",width:"36"})]),n("p",rt,r(a(s)("docker.messages.dockerNotRunning")),1),c(u,{type:"primary",size:"small",onClick:O,loading:C.value,class:"start-btn",round:""},{default:k(()=>[c(a(d),{icon:"mdi:play",width:"14"}),T(" "+r(a(s)("docker.buttons.startDocker")),1)]),_:1},8,["loading"])]))])]),_:1})),[[V,S.value]])}}}),Nt=q(It,[["__scopeId","data-v-8afb77b7"]]);export{Nt as default};

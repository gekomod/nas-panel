import{_ as R,b as a,d as y,e as h,g as t,w as l,f as _,F as I,l as J,h as L,m as u,t as T,v as r}from"./index-naspanel.js";const E={data(){return{activeTab:"backup",backupFrequency:"weekly",backupLocation:"/var/backups/docker",backupIncludes:["compose","volumes","config"],backupFiles:[],scheduledJobs:[],cronExpression:"0 2 * * *",frequencyOptions:[{label:"Daily (2:00 AM)",value:"0 2 * * *"},{label:"Weekly (Monday 2:00 AM)",value:"0 2 * * 1"},{label:"Monthly (1st 2:00 AM)",value:"0 2 1 * *"},{label:"Custom",value:"custom"}]}},computed:{frequencyLabel(){const s=this.frequencyOptions.find(e=>e.value===this.cronExpression);return s?s.label:"Custom"}},methods:{async runBackup(){try{const s=await r.post("/services/docker/backup",{location:this.backupLocation,includes:this.backupIncludes});this.$message.success(s.data.message),this.fetchBackupFiles()}catch(s){this.$message.error("Backup failed: "+s.message)}},async scheduleBackup(){try{const s=await r.post("/services/docker/backup/schedule",{schedule:this.cronExpression,location:this.backupLocation,includes:this.backupIncludes}),e=await r.post("/system/cron-jobs",{name:"Docker Backup Schedule",description:"Scheduled backup for Docker services",job:"docker_backup_schedule",command:`/usr/local/bin/docker-backup --location ${this.backupLocation} --includes ${this.backupIncludes.join(",")}`,schedule:this.cronExpression});this.$message.success(s.data.message),this.fetchScheduledJobs()}catch(s){this.$message.error("Failed to schedule backup: "+s.message)}},async fetchBackupFiles(){try{const s=await r.get("/services/docker/backup/list");this.backupFiles=s.data.files}catch{this.$message.error("Failed to fetch backup files")}},async fetchScheduledJobs(){try{const s=await r.get("/services/docker/backup/schedules");this.scheduledJobs=Object.entries(s.data.jobs).map(([e,m])=>({id:e,...m,nextRun:this.getNextRun(m.schedule)}))}catch(s){console.error("Failed to fetch scheduled jobs:",s)}},getNextRun(s){try{return cron.parseExpression(s).next().toISOString()}catch{return"Unknown"}},async removeScheduledJob(s){try{await this.$confirm("Remove this scheduled backup?","Warning",{confirmButtonText:"Remove",cancelButtonText:"Cancel",type:"warning"}),await r.delete(`/services/docker/backup/schedule/${s}`),this.$message.success("Scheduled backup removed"),this.fetchScheduledJobs()}catch(e){e!=="cancel"&&this.$message.error("Failed to remove scheduled backup")}},async restoreBackup(s){try{await this.$confirm(`Restore from ${s.name}? This will overwrite current configuration.`,"Warning",{confirmButtonText:"Restore",cancelButtonText:"Cancel",type:"warning"});const e=await r.post("/services/docker/backup/restore",{file:s.name});this.$message.success(e.data.message)}catch(e){e!=="cancel"&&this.$message.error("Restore failed: "+e.message)}}},mounted(){this.fetchBackupFiles(),this.fetchScheduledJobs()}},q={class:"docker-backup"};function D(s,e,m,N,c,i){const g=a("el-option"),x=a("el-select"),d=a("el-form-item"),B=a("el-input"),b=a("el-checkbox"),w=a("el-checkbox-group"),p=a("el-button"),C=a("el-form"),F=a("el-divider"),n=a("el-table-column"),f=a("el-table"),v=a("el-tab-pane"),S=a("el-tabs"),V=a("el-card");return h(),y("div",q,[t(V,null,{header:l(()=>e[4]||(e[4]=[_("div",{class:"card-header"},[_("span",null,"Backup & Restore")],-1)])),default:l(()=>[t(S,{modelValue:c.activeTab,"onUpdate:modelValue":e[3]||(e[3]=o=>c.activeTab=o)},{default:l(()=>[t(v,{label:"Backup",name:"backup"},{default:l(()=>[t(C,{"label-width":"200px"},{default:l(()=>[t(d,{label:"Backup Frequency"},{default:l(()=>[t(x,{modelValue:c.cronExpression,"onUpdate:modelValue":e[0]||(e[0]=o=>c.cronExpression=o)},{default:l(()=>[(h(!0),y(I,null,J(c.frequencyOptions,o=>(h(),L(g,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"Backup Location"},{default:l(()=>[t(B,{modelValue:c.backupLocation,"onUpdate:modelValue":e[1]||(e[1]=o=>c.backupLocation=o),placeholder:"/path/to/backup"},null,8,["modelValue"])]),_:1}),t(d,{label:"Include"},{default:l(()=>[t(w,{modelValue:c.backupIncludes,"onUpdate:modelValue":e[2]||(e[2]=o=>c.backupIncludes=o)},{default:l(()=>[t(b,{label:"compose",value:"compose"},{default:l(()=>e[5]||(e[5]=[u("Compose Files")])),_:1,__:[5]}),t(b,{label:"volumes",value:"volumes"},{default:l(()=>e[6]||(e[6]=[u("Volumes")])),_:1,__:[6]}),t(b,{label:"config",value:"config"},{default:l(()=>e[7]||(e[7]=[u("Configuration")])),_:1,__:[7]})]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:l(()=>[t(p,{type:"primary",onClick:i.runBackup},{default:l(()=>e[8]||(e[8]=[u("Run Backup Now")])),_:1,__:[8]},8,["onClick"]),t(p,{onClick:i.scheduleBackup},{default:l(()=>e[9]||(e[9]=[u("Schedule Backup")])),_:1,__:[9]},8,["onClick"])]),_:1})]),_:1}),t(F),e[11]||(e[11]=_("h3",null,"Scheduled Backups",-1)),t(f,{data:c.scheduledJobs,style:{width:"100%"}},{default:l(()=>[t(n,{prop:"id",label:"ID",width:"180"}),t(n,{label:"Schedule"},{default:l(({row:o})=>[u(T(c.frequencyOptions.find(k=>k.value===o.schedule)?.label||o.schedule),1)]),_:1}),t(n,{prop:"nextRun",label:"Next Run"}),t(n,{label:"Actions",width:"120"},{default:l(({row:o})=>[t(p,{type:"danger",size:"small",onClick:k=>i.removeScheduledJob(o.id)},{default:l(()=>e[10]||(e[10]=[u(" Remove ")])),_:2,__:[10]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1,__:[11]}),t(v,{label:"Restore",name:"restore"},{default:l(()=>[t(f,{data:c.backupFiles,style:{width:"100%"}},{default:l(()=>[t(n,{prop:"name",label:"File"}),t(n,{prop:"date",label:"Date",width:"180"}),t(n,{prop:"size",label:"Size",width:"120"}),t(n,{label:"Actions",width:"120"},{default:l(({row:o})=>[t(p,{type:"primary",size:"small",onClick:k=>i.restoreBackup(o)},{default:l(()=>e[12]||(e[12]=[u("Restore")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}const j=R(E,[["render",D]]);export{j as default};

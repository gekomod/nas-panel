import{_ as me,s as F,r as c,o as ce,H as fe,b as u,A as _e,d as W,e as h,g as t,w as a,B as C,f as o,n as Z,k as p,I as m,t as d,G as ge,h as I,i as ve,m as r,v,x as _}from"./index-naspanel.js";const we={class:"ups-monitoring"},ye={class:"card-header"},be={class:"status-card"},he={class:"status-info"},Se={class:"card-header"},ze={class:"battery-chart"},Ve={class:"battery-level"},Ue={class:"battery-text"},Pe={class:"battery-stats"},Ne={class:"stat-item"},ke={class:"stat-item"},Be={class:"stat-item"},Ce={class:"stat-item"},Ie={class:"card-header"},xe={class:"card-header"},Le={class:"card-header"},Te={__name:"UPSMonitoring",setup(je){const i=F({status:"unknown",battery:0,runtime:0,voltage:0,load:0,temperature:0,inputVoltage:0,outputVoltage:0}),g=F({model:"",mfr:"",serial:"",firmware:"",date:"",nominalVoltage:"",nominalPower:""}),l=F({upsName:"nas-ups",driver:"usbhid-ups",port:"auto",autoShutdown:!0,shutdownLevel:20,delay:30,notifications:!0,monitoring:!0,pollInterval:5,maxRetries:3}),H=c([]),V=c(!1),U=c(!1),x=c(!1),P=c(!1),L=c(!1),T=c(!1),j=c(!1),N=c(!1),A=c("quick"),Q={OL:"online",OB:"battery",LB:"lowbattery",HB:"highbattery",RB:"battery-test",CHRG:"charging",DISCHRG:"discharging",BYPASS:"bypass",CAL:"calibration",OFF:"off",OVER:"overloaded",TRIM:"trim",BOOST:"boost",FSD:"forced-shutdown"},X=n=>({online:"online",battery:"battery",lowbattery:"lowbattery",charging:"charging",discharging:"discharging",overloaded:"danger","forced-shutdown":"danger"})[n]||"unknown",Y=n=>({online:"mdi:power-plug",battery:"mdi:battery-70",lowbattery:"mdi:battery-alert",charging:"mdi:battery-charging-70",discharging:"mdi:battery-arrow-down",overloaded:"mdi:alert-octagon","forced-shutdown":"mdi:power-off",unknown:"mdi:alert-circle"})[n]||"mdi:alert-circle",$=n=>({online:"Podłączony do sieci",battery:"Praca na baterii",lowbattery:"Niski poziom baterii",charging:"Ładowanie",discharging:"Rozładowywanie",overloaded:"Przeciążenie","forced-shutdown":"Wymuszone wyłączenie",unknown:"Status nieznany"})[n]||n,J=n=>n>70?"high":n>30?"medium":"low",D=async()=>{V.value=!0;try{const e=(await v.get("/ups/status")).data.status;i.status=Q[e.status]||"unknown",i.battery=parseInt(e.batteryCharge)||0,i.runtime=parseInt(e.batteryRuntime)/60||0,i.voltage=parseFloat(e.inputVoltage)||0,i.load=parseInt(e.upsLoad)||0,i.temperature=parseFloat(e.batteryTemperature)||0,i.inputVoltage=parseFloat(e.inputVoltage)||0,i.outputVoltage=parseFloat(e.outputVoltage)||0}catch(n){console.error("Błąd podczas ładowania statusu UPS:",n),_.error("Nie udało się załadować statusu UPS")}finally{V.value=!1}},ee=async()=>{x.value=!0;try{const n=await v.get("/ups/details");Object.assign(g,n.data.details)}catch(n){console.error("Błąd podczas ładowania szczegółów UPS:",n)}finally{x.value=!1}},R=async()=>{U.value=!0;try{const e=(await v.get("/ups/config/nut")).data.config;e.upsName&&(l.upsName=e.upsName),e.driver&&(l.driver=e.driver),e.port&&(l.port=e.port),e.shutdownLevel&&(l.shutdownLevel=parseInt(e.shutdownLevel)),e.delay&&(l.delay=parseInt(e.delay)),e.pollInterval&&(l.pollInterval=parseInt(e.pollInterval)),e.maxRetries&&(l.maxRetries=parseInt(e.maxRetries)),l.autoShutdown=e.autoShutdown!==!1,l.notifications=e.notifications!==!1,l.monitoring=e.monitoring!==!1}catch(n){console.error("Błąd podczas ładowania konfiguracji UPS:",n),_.warning("Konfiguracja NUT niedostępna, używam domyślnej")}finally{U.value=!1}},E=async()=>{P.value=!0;try{const n=await v.get("/ups/events");H.value=n.data.events}catch(n){console.error("Błąd podczas ładowania zdarzeń UPS:",n),_.error("Nie udało się załadować zdarzeń UPS")}finally{P.value=!1}},te=async()=>{L.value=!0;try{await v.post("/ups/config",{config:l});const n=await v.post("/ups/config/nut",{config:l});_.success("Konfiguracja UPS zapisana"),await R()}catch(n){console.error("Błąd podczas zapisywania konfiguracji UPS:",n),_.error("Nie udało się zapisać konfiguracji UPS")}finally{L.value=!1}},ae=async()=>{T.value=!0;try{await v.post("/ups/service/restart"),_.success("Usługa NUT zrestartowana")}catch(n){console.error("Błąd podczas restartowania usługi NUT:",n),_.error("Nie udało się zrestartować usługi NUT")}finally{T.value=!1}},oe=async()=>{j.value=!0;try{await v.post("/ups/test",{type:A.value}),_.success("Test UPS rozpoczęty"),N.value=!1}catch(n){console.error("Błąd podczas uruchamiania testu UPS:",n),_.error("Nie udało się uruchomić testu UPS")}finally{j.value=!1}};let M;return ce(()=>{D(),ee(),R(),E(),M=setInterval(()=>{D()},5e3)}),fe(()=>{M&&clearInterval(M)}),(n,e)=>{const w=u("el-button"),S=u("el-card"),z=u("el-col"),G=u("el-input"),f=u("el-form-item"),y=u("el-option"),le=u("el-select"),O=u("el-switch"),ne=u("el-slider"),se=u("el-input-number"),ie=u("el-form"),q=u("el-row"),b=u("el-descriptions-item"),re=u("el-descriptions"),k=u("el-table-column"),de=u("el-table"),K=u("el-radio"),ue=u("el-radio-group"),pe=u("el-dialog"),B=_e("loading");return h(),W("div",we,[t(q,{gutter:20},{default:a(()=>[t(z,{span:8},{default:a(()=>[t(S,{shadow:"hover"},{header:a(()=>[o("div",ye,[t(p(m),{icon:"mdi:car-battery",width:"24"}),e[11]||(e[11]=o("h3",null,"Status UPS",-1)),t(w,{size:"small",onClick:D,loading:V.value},{default:a(()=>[t(p(m),{icon:"mdi:refresh",width:"16"})]),_:1},8,["loading"])])]),default:a(()=>[C((h(),W("div",be,[o("div",{class:Z(["status-indicator",X(i.status)])},[t(p(m),{icon:Y(i.status),width:"48"},null,8,["icon"])],2),o("div",he,[o("h4",null,d($(i.status)),1),o("p",null,"Bateria: "+d(i.battery)+"%",1),o("p",null,"Czas pracy: "+d(i.runtime)+" min",1),o("p",null,"Napięcie: "+d(i.voltage)+"V",1),o("p",null,"Obciążenie: "+d(i.load)+"%",1),o("p",null,"Temperatura: "+d(i.temperature)+"°C",1)])])),[[B,V.value]])]),_:1})]),_:1}),t(z,{span:8},{default:a(()=>[t(S,{shadow:"hover"},{header:a(()=>[o("div",Se,[t(p(m),{icon:"mdi:chart-line",width:"24"}),e[12]||(e[12]=o("h3",null,"Bateria",-1))])]),default:a(()=>[o("div",ze,[o("div",Ve,[o("div",{class:Z(["battery-fill",J(i.battery)]),style:ge({width:i.battery+"%"})},null,6),o("span",Ue,d(i.battery)+"%",1)]),o("div",Pe,[o("div",Ne,[t(p(m),{icon:"mdi:clock-outline",width:"16"}),o("span",null,"Czas pracy: "+d(i.runtime)+" min",1)]),o("div",ke,[t(p(m),{icon:"mdi:lightning-bolt",width:"16"}),o("span",null,"Napięcie: "+d(i.voltage)+"V",1)]),o("div",Be,[t(p(m),{icon:"mdi:flash",width:"16"}),o("span",null,"Obciążenie: "+d(i.load)+"%",1)]),o("div",Ce,[t(p(m),{icon:"mdi:thermometer",width:"16"}),o("span",null,"Temperatura: "+d(i.temperature)+"°C",1)])])])]),_:1})]),_:1}),t(z,{span:8},{default:a(()=>[t(S,{shadow:"hover"},{header:a(()=>[o("div",Ie,[t(p(m),{icon:"mdi:cog",width:"24"}),e[13]||(e[13]=o("h3",null,"Konfiguracja UPS",-1)),t(w,{size:"small",onClick:R,loading:U.value},{default:a(()=>[t(p(m),{icon:"mdi:refresh",width:"16"})]),_:1},8,["loading"])])]),default:a(()=>[C((h(),I(ie,{model:l,"label-width":"160px"},{default:a(()=>[t(f,{label:"Nazwa UPS"},{default:a(()=>[t(G,{modelValue:l.upsName,"onUpdate:modelValue":e[0]||(e[0]=s=>l.upsName=s)},null,8,["modelValue"])]),_:1}),t(f,{label:"Sterownik"},{default:a(()=>[t(le,{modelValue:l.driver,"onUpdate:modelValue":e[1]||(e[1]=s=>l.driver=s)},{default:a(()=>[t(y,{value:"usbhid-ups"},{default:a(()=>e[14]||(e[14]=[r("USB HID")])),_:1,__:[14]}),t(y,{value:"blazer_usb"},{default:a(()=>e[15]||(e[15]=[r("Blazer USB")])),_:1,__:[15]}),t(y,{value:"nutdrv_qx"},{default:a(()=>e[16]||(e[16]=[r("Nutdrv QX")])),_:1,__:[16]}),t(y,{value:"snmp-ups"},{default:a(()=>e[17]||(e[17]=[r("SNMP")])),_:1,__:[17]}),t(y,{value:"blazer_ser"},{default:a(()=>e[18]||(e[18]=[r("Blazer Serial")])),_:1,__:[18]}),t(y,{value:"megatec"},{default:a(()=>e[19]||(e[19]=[r("Megatec")])),_:1,__:[19]}),t(y,{value:"apcsmart"},{default:a(()=>e[20]||(e[20]=[r("APC Smart")])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"Port"},{default:a(()=>[t(G,{modelValue:l.port,"onUpdate:modelValue":e[2]||(e[2]=s=>l.port=s),placeholder:"auto, /dev/ttyUSB0, /dev/ttyS0"},null,8,["modelValue"])]),_:1}),t(f,{label:"Auto wyłączanie"},{default:a(()=>[t(O,{modelValue:l.autoShutdown,"onUpdate:modelValue":e[3]||(e[3]=s=>l.autoShutdown=s)},null,8,["modelValue"])]),_:1}),l.autoShutdown?(h(),I(f,{key:0,label:"Próg baterii"},{default:a(()=>[t(ne,{modelValue:l.shutdownLevel,"onUpdate:modelValue":e[4]||(e[4]=s=>l.shutdownLevel=s),min:5,max:50,step:5},null,8,["modelValue"]),o("span",null,d(l.shutdownLevel)+"%",1)]),_:1})):ve("",!0),t(f,{label:"Czas opóźnienia"},{default:a(()=>[t(se,{modelValue:l.delay,"onUpdate:modelValue":e[5]||(e[5]=s=>l.delay=s),min:0,max:300},null,8,["modelValue"]),e[21]||(e[21]=o("span",null,"sekund",-1))]),_:1,__:[21]}),t(f,{label:"Powiadomienia"},{default:a(()=>[t(O,{modelValue:l.notifications,"onUpdate:modelValue":e[6]||(e[6]=s=>l.notifications=s)},null,8,["modelValue"])]),_:1}),t(f,{label:"Monitorowanie"},{default:a(()=>[t(O,{modelValue:l.monitoring,"onUpdate:modelValue":e[7]||(e[7]=s=>l.monitoring=s)},null,8,["modelValue"])]),_:1}),t(f,null,{default:a(()=>[t(w,{type:"primary",onClick:te,loading:L.value},{default:a(()=>[t(p(m),{icon:"mdi:content-save",width:"16"}),e[22]||(e[22]=r(" Zapisz konfigurację "))]),_:1,__:[22]},8,["loading"]),t(w,{onClick:ae,loading:T.value},{default:a(()=>[t(p(m),{icon:"mdi:restart",width:"16"}),e[23]||(e[23]=r(" Restartuj usługę "))]),_:1,__:[23]},8,["loading"])]),_:1})]),_:1},8,["model"])),[[B,U.value]])]),_:1})]),_:1})]),_:1}),t(q,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[t(z,{span:12},{default:a(()=>[t(S,{shadow:"hover"},{header:a(()=>[o("div",xe,[t(p(m),{icon:"mdi:information",width:"24"}),e[24]||(e[24]=o("h3",null,"Szczegóły UPS",-1))])]),default:a(()=>[C((h(),I(re,{column:1,border:""},{default:a(()=>[t(b,{label:"Model"},{default:a(()=>[r(d(g.model||"N/A"),1)]),_:1}),t(b,{label:"Producent"},{default:a(()=>[r(d(g.mfr||"N/A"),1)]),_:1}),t(b,{label:"Numer seryjny"},{default:a(()=>[r(d(g.serial||"N/A"),1)]),_:1}),t(b,{label:"Wersja firmware"},{default:a(()=>[r(d(g.firmware||"N/A"),1)]),_:1}),t(b,{label:"Data produkcji"},{default:a(()=>[r(d(g.date||"N/A"),1)]),_:1}),t(b,{label:"Nominalne napięcie"},{default:a(()=>[r(d(g.nominalVoltage||"N/A")+"V",1)]),_:1}),t(b,{label:"Nominalna moc"},{default:a(()=>[r(d(g.nominalPower||"N/A")+"VA",1)]),_:1})]),_:1})),[[B,x.value]])]),_:1})]),_:1}),t(z,{span:12},{default:a(()=>[t(S,{shadow:"hover"},{header:a(()=>[o("div",Le,[t(p(m),{icon:"mdi:history",width:"24"}),e[25]||(e[25]=o("h3",null,"Historia zdarzeń",-1)),t(w,{size:"small",onClick:E,loading:P.value},{default:a(()=>[t(p(m),{icon:"mdi:refresh",width:"16"})]),_:1},8,["loading"])])]),default:a(()=>[C((h(),I(de,{data:H.value,style:{width:"100%"},height:"300"},{default:a(()=>[t(k,{prop:"timestamp",label:"Data",width:"160"}),t(k,{prop:"event",label:"Zdarzenie"}),t(k,{prop:"battery",label:"Bateria",width:"80"},{default:a(({row:s})=>[r(d(s.battery)+"% ",1)]),_:1}),t(k,{prop:"runtime",label:"Czas pracy",width:"100"},{default:a(({row:s})=>[r(d(s.runtime)+" min ",1)]),_:1})]),_:1},8,["data"])),[[B,P.value]])]),_:1})]),_:1})]),_:1}),t(pe,{modelValue:N.value,"onUpdate:modelValue":e[10]||(e[10]=s=>N.value=s),title:"Test UPS",width:"500px"},{footer:a(()=>[t(w,{onClick:e[9]||(e[9]=s=>N.value=!1)},{default:a(()=>e[28]||(e[28]=[r("Anuluj")])),_:1,__:[28]}),t(w,{type:"primary",onClick:oe,loading:j.value},{default:a(()=>e[29]||(e[29]=[r(" Uruchom test ")])),_:1,__:[29]},8,["loading"])]),default:a(()=>[e[30]||(e[30]=o("p",null,"Testowanie działania UPS. Wybierz typ testu:",-1)),t(ue,{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=s=>A.value=s),style:{margin:"20px 0"}},{default:a(()=>[t(K,{label:"quick"},{default:a(()=>e[26]||(e[26]=[r("Szybki test baterii")])),_:1,__:[26]}),t(K,{label:"deep"},{default:a(()=>e[27]||(e[27]=[r("Głęboki test baterii")])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1,__:[30]},8,["modelValue"])])}}},De=me(Te,[["__scopeId","data-v-be138e09"]]);export{De as default};

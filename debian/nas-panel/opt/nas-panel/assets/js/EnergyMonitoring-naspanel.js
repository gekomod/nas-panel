import{_ as Y,r as u,c as U,o as $,H as ee,b as v,A as te,d as i,e as n,g as a,h as V,i as B,w as s,f as e,k as r,I as c,t as d,m as b,B as ae,v as E,x as F}from"./index-naspanel.js";const se={class:"energy-monitoring"},oe={class:"stat-content"},ne={class:"stat-icon current"},le={class:"stat-info"},ie={key:0,class:"stat-value"},de={key:1,class:"stat-value"},re={key:2,class:"stat-timestamp"},ce={class:"stat-content"},ue={class:"stat-icon today"},ve={class:"stat-info"},_e={key:0,class:"stat-value"},pe={key:1,class:"stat-value"},he={class:"stat-content"},ye={class:"stat-icon month"},me={class:"stat-info"},ge={key:0,class:"stat-value"},fe={key:1,class:"stat-value"},we={class:"stat-content"},ze={class:"stat-icon cost"},ke={class:"stat-info"},be={key:0,class:"stat-value"},xe={key:1,class:"stat-value"},Ce={class:"card-header"},Me={key:0,class:"chart-container"},Be={class:"chart-placeholder"},Ee={class:"history-stats"},We={key:1,class:"chart-container"},De={class:"chart-placeholder"},je={class:"card-header"},Se={key:0,class:"forecast"},Ie={class:"forecast-item"},Ue={class:"forecast-value"},Ve={class:"forecast-item"},Fe={class:"forecast-value"},Re={class:"forecast-item"},Ne={class:"forecast-value"},Pe={class:"energy-rate"},Ze={class:"rate-controls"},He={key:1,class:"forecast-unavailable"},Le={class:"card-header"},Te={key:2,class:"no-devices"},Ae={__name:"EnergyMonitoring",setup(Ke){const W=u(null),f=u(null),_=u(null),p=u(.85),w=u([]),h=u([]),D=u(null),y=u(!1),x=u(!1),z=u(!1),C=u(!1),H=U(()=>f.value===null?"--":(f.value*p.value).toFixed(2)),j=U(()=>_.value===null?"--":(_.value*p.value).toFixed(2)),L=U(()=>_.value===null?"--":(_.value*12*p.value).toFixed(2)),T=o=>o>40?"#e6a23c":o>20?"#409eff":"#67c23a",R=async()=>{try{const t=(await E.get("/energy/status")).data.status;if(t.available===!1){y.value=!0;return}W.value=t.currentPower,f.value=parseFloat(t.todayEnergy),_.value=parseFloat(t.monthEnergy),D.value=new Date().toLocaleTimeString(),y.value=!1}catch(o){console.error("Błąd podczas ładowania danych energii:",o),y.value=!0,F.warning("System monitorowania energii niedostępny")}},S=async()=>{C.value=!0;try{const o=await E.get("/energy/history");h.value=o.data.history||[]}catch(o){console.error("Błąd podczas ładowania historii energii:",o),h.value=[]}finally{C.value=!1}},N=async()=>{z.value=!0;try{const o=await E.get("/energy/devices");o.data.available===!1?(x.value=!0,w.value=[]):(x.value=!1,w.value=o.data.devices||[])}catch(o){console.error("Błąd podczas ładowania zużycia urządzeń:",o),x.value=!0,w.value=[]}finally{z.value=!1}},A=async()=>{try{await E.post("/energy/rate",{rate:p.value}),F.success("Stawka energii zapisana")}catch(o){console.error("Błąd podczas zapisywania stawki energii:",o),F.error("Nie udało się zapisać stawki energii")}},K=()=>{const o=localStorage.getItem("energyRate");o&&(p.value=parseFloat(o))};let I;return $(()=>{K(),R(),N(),S(),I=setInterval(()=>{R()},3e4)}),ee(()=>{I&&clearInterval(I)}),(o,t)=>{const m=v("el-card"),g=v("el-col"),P=v("el-row"),Z=v("el-alert"),M=v("el-button"),q=v("el-divider"),G=v("el-input-number"),k=v("el-table-column"),J=v("el-progress"),O=v("el-table"),Q=te("loading");return n(),i("div",se,[a(P,{gutter:20},{default:s(()=>[a(g,{span:6},{default:s(()=>[a(m,{shadow:"hover",class:"stat-card"},{default:s(()=>[e("div",oe,[e("div",ne,[a(r(c),{icon:"mdi:lightning-bolt",width:"32"})]),e("div",le,[W.value!==null?(n(),i("div",ie,d(W.value)+" W",1)):(n(),i("div",de,"--")),t[1]||(t[1]=e("div",{class:"stat-label"},"Bieżące zużycie",-1)),D.value?(n(),i("div",re,d(D.value),1)):B("",!0)])])]),_:1})]),_:1}),a(g,{span:6},{default:s(()=>[a(m,{shadow:"hover",class:"stat-card"},{default:s(()=>[e("div",ce,[e("div",ue,[a(r(c),{icon:"mdi:chart-bar",width:"32"})]),e("div",ve,[f.value!==null?(n(),i("div",_e,d(f.value)+" kWh",1)):(n(),i("div",pe,"--")),t[2]||(t[2]=e("div",{class:"stat-label"},"Dzisiaj",-1))])])]),_:1})]),_:1}),a(g,{span:6},{default:s(()=>[a(m,{shadow:"hover",class:"stat-card"},{default:s(()=>[e("div",he,[e("div",ye,[a(r(c),{icon:"mdi:calendar-month",width:"32"})]),e("div",me,[_.value!==null?(n(),i("div",ge,d(_.value)+" kWh",1)):(n(),i("div",fe,"--")),t[3]||(t[3]=e("div",{class:"stat-label"},"Ten miesiąc",-1))])])]),_:1})]),_:1}),a(g,{span:6},{default:s(()=>[a(m,{shadow:"hover",class:"stat-card"},{default:s(()=>[e("div",we,[e("div",ze,[a(r(c),{icon:"mdi:cash",width:"32"})]),e("div",ke,[j.value!==null?(n(),i("div",be,d(j.value)+" zł",1)):(n(),i("div",xe,"--")),t[4]||(t[4]=e("div",{class:"stat-label"},"Koszt miesięczny",-1))])])]),_:1})]),_:1})]),_:1}),y.value?(n(),V(Z,{key:0,title:"Dane niedostępne",type:"warning",description:"System monitorowania energii nie jest dostępny. Sprawdź konfigurację lub zainstaluj odpowiednie narzędzia.","show-icon":"",style:{"margin-top":"20px"}})):B("",!0),a(P,{gutter:20,style:{"margin-top":"20px"}},{default:s(()=>[a(g,{span:16},{default:s(()=>[a(m,{shadow:"hover"},{header:s(()=>[e("div",Ce,[a(r(c),{icon:"mdi:chart-line",width:"24"}),t[5]||(t[5]=e("h3",null,"Zużycie energii - 24h",-1)),a(M,{size:"small",onClick:S,loading:C.value},{default:s(()=>[a(r(c),{icon:"mdi:refresh",width:"16"})]),_:1},8,["loading"])])]),default:s(()=>[h.value.length>0?(n(),i("div",Me,[e("div",Be,[a(r(c),{icon:"mdi:chart-areaspline",width:"64"}),t[6]||(t[6]=e("p",null,"Wykres historycznego zużycia energii",-1)),e("div",Ee,[e("div",null,"Min: "+d(Math.min(...h.value.map(l=>l.power)))+"W",1),e("div",null,"Max: "+d(Math.max(...h.value.map(l=>l.power)))+"W",1),e("div",null,"Średnia: "+d(Math.round(h.value.reduce((l,X)=>l+X.power,0)/h.value.length))+"W",1)])])])):(n(),i("div",We,[e("div",De,[a(r(c),{icon:"mdi:chart-line",width:"64"}),t[8]||(t[8]=e("p",null,"Brak danych historycznych",-1)),a(M,{onClick:S,loading:C.value},{default:s(()=>t[7]||(t[7]=[b(" Załaduj dane ")])),_:1,__:[7]},8,["loading"])])]))]),_:1})]),_:1}),a(g,{span:8},{default:s(()=>[a(m,{shadow:"hover"},{header:s(()=>[e("div",je,[a(r(c),{icon:"mdi:progress-clock",width:"24"}),t[9]||(t[9]=e("h3",null,"Prognoza kosztów",-1))])]),default:s(()=>[y.value?(n(),i("div",He,[a(r(c),{icon:"mdi:alert-circle",width:"32"}),t[16]||(t[16]=e("p",null,"Prognoza niedostępna",-1))])):(n(),i("div",Se,[e("div",Ie,[t[10]||(t[10]=e("span",null,"Dzisiejszy koszt:",-1)),e("span",Ue,d(H.value)+" zł",1)]),e("div",Ve,[t[11]||(t[11]=e("span",null,"Miesięczny koszt:",-1)),e("span",Fe,d(j.value)+" zł",1)]),e("div",Re,[t[12]||(t[12]=e("span",null,"Roczny koszt:",-1)),e("span",Ne,d(L.value)+" zł",1)]),a(q),e("div",Pe,[t[15]||(t[15]=e("h4",null,"Stawka energii",-1)),e("div",Ze,[a(G,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=l=>p.value=l),min:.1,max:2,step:.01,size:"small",disabled:y.value},null,8,["modelValue","disabled"]),t[13]||(t[13]=e("span",null,"zł/kWh",-1))]),a(M,{size:"small",onClick:A,disabled:y.value,style:{"margin-top":"10px"}},{default:s(()=>t[14]||(t[14]=[b(" Zapisz stawkę ")])),_:1,__:[14]},8,["disabled"])])]))]),_:1})]),_:1})]),_:1}),a(m,{shadow:"hover",style:{"margin-top":"20px"}},{header:s(()=>[e("div",Le,[a(r(c),{icon:"mdi:power-plug",width:"24"}),t[17]||(t[17]=e("h3",null,"Zużycie per urządzenie",-1)),a(M,{size:"small",onClick:N,loading:z.value},{default:s(()=>[a(r(c),{icon:"mdi:refresh",width:"16"})]),_:1},8,["loading"])])]),default:s(()=>[x.value?(n(),V(Z,{key:0,title:"Monitorowanie urządzeń niedostępne",type:"info",description:"Aby śledzić zużycie energii per urządzenie, zainstaluj narzędzia monitorujące takie jak powertop lub iotop.","show-icon":"",style:{"margin-bottom":"20px"}})):B("",!0),w.value.length>0?ae((n(),V(O,{key:1,data:w.value,style:{width:"100%"}},{default:s(()=>[a(k,{prop:"name",label:"Urządzenie"}),a(k,{prop:"power",label:"Moc",width:"100"},{default:s(({row:l})=>[b(d(l.power)+" W ",1)]),_:1}),a(k,{prop:"daily",label:"Dzienne",width:"100"},{default:s(({row:l})=>[b(d(l.daily)+" kWh ",1)]),_:1}),a(k,{prop:"monthly",label:"Miesięczne",width:"100"},{default:s(({row:l})=>[b(d(l.monthly)+" kWh ",1)]),_:1}),a(k,{label:"Udział",width:"120"},{default:s(({row:l})=>[a(J,{percentage:l.percentage,color:T(l.percentage)},null,8,["percentage","color"])]),_:1})]),_:1},8,["data"])),[[Q,z.value]]):z.value?B("",!0):(n(),i("div",Te,[a(r(c),{icon:"mdi:devices-off",width:"48"}),t[18]||(t[18]=e("p",null,"Brak danych o zużyciu urządzeń",-1))]))]),_:1})])}}},Ge=Y(Ae,[["__scopeId","data-v-9d571751"]]);export{Ge as default};

import{_ as te,u as le,r as u,c as m,o as oe,W as ne,b as ie,A as re,d as k,e as g,B as ce,g as r,h as K,w as c,f as e,i as T,k as n,I as y,m as f,t as a,G as _,n as A,a6 as W,a7 as C,a8 as F,a9 as de,Q as ue,aa as ve,v as R,ab as me}from"./index-naspanel.js";const fe={class:"widget-header"},pe={class:"header-main"},we={class:"header-icon"},ge={class:"update-time"},ye={class:"header-sub"},_e={class:"system"},he={class:"widget-content"},ze={key:0,class:"usage-info"},be={class:"info-row"},ke={class:"info-text"},Ce={class:"usage-progress"},xe={class:"progress-labels-top"},Be={class:"progress-bar"},Me={class:"main-stats"},Ae={class:"stat-row"},Re={class:"stat-label"},De={class:"stat-value"},je={class:"stat-percentage"},Ve={class:"stat-row"},Ue={class:"stat-label"},Pe={class:"stat-value"},Ee={class:"stat-percentage"},Se={class:"stat-row"},Ie={class:"stat-label"},Ne={class:"stat-value"},$e={class:"stat-percentage"},Te={class:"stat-row"},We={class:"stat-value"},Fe={class:"breakdown-section"},Le={class:"breakdown-title"},Oe={class:"breakdown-total"},Ze={class:"breakdown-visual"},Ge={class:"segment-tooltip"},Je={class:"segment-tooltip"},Ke={class:"segment-tooltip"},Qe={class:"segment-tooltip"},qe={key:1,class:"pressure-section"},He={class:"pressure-header"},Xe={class:"pressure-info"},Ye={class:"widget-footer"},es={class:"metrics-content"},ss={class:"metrics-grid"},as={class:"metric-card"},ts={class:"metric-value"},ls={class:"metric-card"},os={class:"metric-value"},ns={class:"metric-card"},is={class:"metric-value"},rs={class:"memory-breakdown"},cs={class:"breakdown-list"},ds={class:"breakdown-item"},us={class:"item-value"},vs={class:"breakdown-item"},ms={class:"item-value"},fs={class:"breakdown-item"},ps={class:"item-value"},ws={class:"breakdown-item"},gs={class:"item-value"},ys={class:"breakdown-item"},_s={class:"item-value"},hs={class:"breakdown-item"},zs={class:"item-value"},bs={key:0,class:"detailed-content"},ks={class:"detailed-section"},Cs={key:1,class:"loading-details"},xs={class:"confirm-content"},Bs={class:"cache-details"},Ms={class:"dialog-footer"},As={name:"RamWidget",displayName:"RAM"},Rs=Object.assign(As,{setup(Ds){const{t:D}=le(),{addNotification:j}=me(),t=u({}),h=u(null),V=u(!1),U=u(!1),L=u(!0),P=u(D("common.loading")),E=u(!0);let S=null;u(!1);const z=u(!1),x=u(""),B=u(!1);u(!1),u({sync:!0,safeMode:!1});const o=m(()=>t.value.raw?.total||0),b=m(()=>o.value===0?0:o.value-(t.value.raw?.available||0)),d=m(()=>o.value===0?0:Math.round(b.value/o.value*100)),Q=m(()=>{if(o.value===0)return 0;const l=t.value.raw?.free||0;return Math.round((o.value-l)/o.value*100)}),I=m(()=>{if(o.value===0)return 0;const l=t.value.raw?.used||0;return Math.round(l/o.value*100)}),N=m(()=>o.value===0?0:Math.round((t.value.raw?.cached||0)/o.value*100)),O=m(()=>o.value===0?0:Math.round((t.value.raw?.buffers||0)/o.value*100)),Z=m(()=>o.value===0?0:Math.round((t.value.raw?.available||0)/o.value*100)),G=m(()=>o.value===0?0:Math.round((t.value.raw?.free||0)/o.value*100)),$=l=>l>=90?"critical":l>=75?"warning":"normal",q=l=>l>=.8?"critical":l>=.5?"warning":"normal",i=l=>{if(!l||l===0)return"0 B";const s=["B","KB","MB","GB","TB"];let v=l,p=0;for(;v>=1024&&p<s.length-1;)v/=1024,p++;return`${v.toFixed(p===0?0:1)} ${s[p]}`},M=async()=>{try{E.value=!0;const l=await R.get("/api/ram");t.value=l.data,P.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),setTimeout(()=>{L.value=!1},15e3)}catch(l){console.error("Błąd RAM:",l),P.value=D("common.error"),t.value={raw:{total:16*1024*1024*1024,used:10*1024*1024*1024,free:6*1024*1024*1024,available:13*1024*1024*1024,buffers:256*1024*1024,cached:6.5*1024*1024*1024},percentages:{used:63,free:38,cached:41,buffers:2,available:81},usage:{traditional:63,actual:19,withCache:63},pressure:{some:.05,full:.01}}}finally{E.value=!1}},H=async()=>{try{const l=await R.get("/api/ram/detailed");h.value=l.data}catch(l){console.error("Błąd szczegółowych danych RAM:",l),h.value=null}},X=()=>{V.value=!0},Y=async()=>{U.value=!0,h.value||await H()},ee=()=>{z.value=!0,(t.value.raw?.cached||0)<50*1024*1024?x.value="Cache jest już mały, czyszczenie może nie być potrzebne.":x.value=""},se=async()=>{try{B.value=!0,z.value=!1;const l=t.value.raw?.cached||0,s=t.value.raw?.buffers||0,v=await R.post("/api/ram/clear-cache");if(v.data.success){const p=v.data.ramAfter?.cached||0,w=v.data.ramAfter?.buffers||0,J=l-p,ae=s-w;j({type:"success",title:"Cache RAM wyczyszczony",message:`Zwolniono ${i(J)} cache i ${i(ae)} buffers`,details:v.data.message,autoClose:!0,timeout:5e3}),ElMessage({message:`Cache wyczyszczony! Zwolniono ${i(J)}`,type:"success",duration:3e3}),await M()}else throw new Error(v.data.error||"Nieznany błąd")}catch(l){console.error("Błąd czyszczenia cache:",l),j({type:"error",title:"Błąd czyszczenia cache RAM",message:l.response?.data?.details||l.message,details:"Operacja może wymagać uprawnień administratora.",autoClose:!1});try{(await R.post("/api/ram/clear-cache-safe",{ramBefore:{cached:t.value.raw?.cached||0,buffers:t.value.raw?.buffers||0}})).data.success&&(j({type:"success",title:"Cache RAM wyczyszczony (tryb bezpieczny)",message:"Cache został pomyślnie wyczyszczony",autoClose:!0,timeout:4e3}),await M())}catch(s){console.error("Błąd bezpiecznego czyszczenia:",s)}}finally{B.value=!1}};return oe(()=>{M(),S=setInterval(M,3e4)}),ne(()=>{S&&clearInterval(S)}),(l,s)=>{const v=ie("el-card"),p=re("loading");return g(),k("div",null,[ce((g(),K(v,{class:"widget-card",shadow:"hover"},{header:c(()=>[e("div",fe,[e("div",pe,[e("div",we,[r(n(y),{icon:"mdi:memory",width:"16"})]),s[4]||(s[4]=e("span",{class:"header-title"},"RAM",-1)),e("div",ge,[r(n(y),{icon:"mdi:update",width:"12"}),e("span",null,a(n(D)("common.update"))+": "+a(P.value),1)])]),e("div",ye,[e("span",{class:A(["hostname",$(d.value)])},a(d.value)+"% użycia",3),e("span",_e,a(i(o.value))+" całkowitej",1)])])]),default:c(()=>[e("div",he,[L.value?(g(),k("div",ze,[e("div",be,[r(n(y),{icon:"mdi:information",class:"info-icon"}),e("span",ke,[s[5]||(s[5]=f(" Linux używa wolnej pamięci jako cache. Prawdziwe użycie wynosi ")),e("strong",null,a(d.value)+"%",1),s[6]||(s[6]=f(". "))])])])):T("",!0),e("div",Ce,[e("div",xe,[e("span",null,"Użycie rzeczywiste: "+a(d.value)+"%",1),e("span",null,"Z cache: "+a(I.value)+"%",1)]),e("div",Be,[e("div",{class:A(["progress-fill actual",$(d.value)]),style:_({width:`${d.value}%`})},null,6),e("div",{class:"progress-fill cached",style:_({width:`${Math.max(0,I.value-d.value)}%`,left:`${d.value}%`})},null,4)]),s[7]||(s[7]=e("div",{class:"progress-labels"},[e("span",null,"0%"),e("span",null,"50%"),e("span",null,"100%")],-1))]),e("div",Me,[e("div",Ae,[e("span",Re,[r(n(W),{content:"Pamięć faktycznie używana przez aplikacje"},{default:c(()=>s[8]||(s[8]=[e("span",{style:{"border-bottom":"1px dotted #ccc"}},"Rzeczywiste użycie:",-1)])),_:1,__:[8]})]),e("span",De,a(i(b.value)),1),e("span",je,a(d.value)+"%",1)]),e("div",Ve,[e("span",Ue,[r(n(W),{content:"Pamięć wykorzystana jako cache systemowy"},{default:c(()=>s[9]||(s[9]=[e("span",{style:{"border-bottom":"1px dotted #ccc"}},"Cache:",-1)])),_:1,__:[9]})]),e("span",Pe,a(i(t.value.raw?.cached||0)),1),e("span",Ee,a(N.value)+"%",1)]),e("div",Se,[e("span",Ie,[r(n(W),{content:"Pamięć gotowa do natychmiastowego użycia"},{default:c(()=>s[10]||(s[10]=[e("span",{style:{"border-bottom":"1px dotted #ccc"}},"Dostępna:",-1)])),_:1,__:[10]})]),e("span",Ne,a(i(t.value.raw?.available||0)),1),e("span",$e,a(Z.value)+"%",1)]),e("div",Te,[s[11]||(s[11]=e("span",{class:"stat-label"},"Całkowita:",-1)),e("span",We,a(i(o.value)),1),s[12]||(s[12]=e("span",{class:"stat-percentage"},"100%",-1))])]),e("div",Fe,[e("div",Le,[s[13]||(s[13]=e("span",null,"Podział pamięci:",-1)),e("span",Oe,a(i(o.value)),1)]),e("div",Ze,[e("div",{class:A(["breakdown-segment actual-segment",$(d.value)]),style:_({flex:b.value/o.value})},[e("div",Ge," Aplikacje: "+a(i(b.value))+" ("+a(d.value)+"%) ",1)],6),e("div",{class:"breakdown-segment cache-segment",style:_({flex:(t.value.raw?.cached||0)/o.value})},[e("div",Je," Cache: "+a(i(t.value.raw?.cached||0))+" ("+a(N.value)+"%) ",1)],4),e("div",{class:"breakdown-segment buffers-segment",style:_({flex:(t.value.raw?.buffers||0)/o.value})},[e("div",Ke," Buffers: "+a(i(t.value.raw?.buffers||0))+" ("+a(O.value)+"%) ",1)],4),e("div",{class:"breakdown-segment free-segment",style:_({flex:(t.value.raw?.free||0)/o.value})},[e("div",Qe," Wolna: "+a(i(t.value.raw?.free||0))+" ("+a(G.value)+"%) ",1)],4)]),s[14]||(s[14]=e("div",{class:"breakdown-legend"},[e("div",{class:"legend-item"},[e("span",{class:"legend-color actual-color"}),e("span",null,"Aplikacje")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color cache-color"}),e("span",null,"Cache")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color buffers-color"}),e("span",null,"Buffers")]),e("div",{class:"legend-item"},[e("span",{class:"legend-color free-color"}),e("span",null,"Wolna")])],-1))]),t.value.pressure?(g(),k("div",qe,[e("div",He,[r(n(y),{icon:"mdi:gauge",width:"12"}),s[15]||(s[15]=e("span",null,"Memory Pressure",-1)),e("span",{class:A(["pressure-value",q(t.value.pressure.some)])},a(t.value.pressure.some.toFixed(2)),3)]),e("div",Xe,[e("small",null,"avg10: some:"+a(t.value.pressure.some.toFixed(2))+" full:"+a(t.value.pressure.full.toFixed(2)),1)])])):T("",!0)]),e("div",Ye,[r(n(C),{size:"small",text:"",onClick:X,class:"footer-btn"},{default:c(()=>[r(n(y),{icon:"mdi:calculator",width:"12"}),s[16]||(s[16]=e("span",null,"Metryki",-1))]),_:1,__:[16]}),r(n(C),{size:"small",text:"",onClick:Y,class:"footer-btn"},{default:c(()=>[r(n(y),{icon:"mdi:information-outline",width:"12"}),s[17]||(s[17]=e("span",null,"Szczegóły",-1))]),_:1,__:[17]}),r(n(C),{size:"small",text:"",onClick:ee,class:"footer-btn",loading:B.value},{default:c(()=>[r(n(y),{icon:"mdi:delete-sweep",width:"12"}),s[18]||(s[18]=e("span",null,"Czyść cache",-1))]),_:1,__:[18]},8,["loading"])])]),_:1})),[[p,E.value]]),r(n(F),{modelValue:V.value,"onUpdate:modelValue":s[0]||(s[0]=w=>V.value=w),title:"Różne metryki użycia pamięci",width:"500px"},{default:c(()=>[e("div",es,[s[32]||(s[32]=e("div",{class:"metrics-explanation"},[e("p",null,[e("strong",null,"Jak Linux zarządza pamięcią:")]),e("ul",null,[e("li",null,[e("strong",null,"Cache"),f(" - dane z dysku przechowywane w RAM dla szybkiego dostępu")]),e("li",null,[e("strong",null,"Buffers"),f(" - dane oczekujące na zapis na dysk")]),e("li",null,[e("strong",null,"Available"),f(" - pamięć gotowa do natychmiastowego użycia")])])],-1)),e("div",ss,[e("div",as,[s[19]||(s[19]=e("div",{class:"metric-title"},"Tradycyjne użycie",-1)),e("div",ts,a(Q.value)+"%",1),s[20]||(s[20]=e("div",{class:"metric-desc"},"(total - free) / total",-1))]),e("div",ls,[s[21]||(s[21]=e("div",{class:"metric-title"},"Rzeczywiste użycie",-1)),e("div",os,a(d.value)+"%",1),s[22]||(s[22]=e("div",{class:"metric-desc"},"(total - available) / total",-1))]),e("div",ns,[s[23]||(s[23]=e("div",{class:"metric-title"},"Użycie z cache",-1)),e("div",is,a(I.value)+"%",1),s[24]||(s[24]=e("div",{class:"metric-desc"},"used / total",-1))])]),e("div",rs,[s[31]||(s[31]=e("h4",null,"Szczegółowy podział:",-1)),e("div",cs,[e("div",ds,[s[25]||(s[25]=e("span",{class:"item-label"},"Pamięć całkowita:",-1)),e("span",us,a(i(o.value)),1)]),e("div",vs,[s[26]||(s[26]=e("span",{class:"item-label"},"Użyta przez aplikacje:",-1)),e("span",ms,a(i(b.value))+" ("+a(d.value)+"%)",1)]),e("div",fs,[s[27]||(s[27]=e("span",{class:"item-label"},"Cache:",-1)),e("span",ps,a(i(t.value.raw?.cached||0))+" ("+a(N.value)+"%)",1)]),e("div",ws,[s[28]||(s[28]=e("span",{class:"item-label"},"Buffers:",-1)),e("span",gs,a(i(t.value.raw?.buffers||0))+" ("+a(O.value)+"%)",1)]),e("div",ys,[s[29]||(s[29]=e("span",{class:"item-label"},"Dostępna:",-1)),e("span",_s,a(i(t.value.raw?.available||0))+" ("+a(Z.value)+"%)",1)]),e("div",hs,[s[30]||(s[30]=e("span",{class:"item-label"},"Wolna:",-1)),e("span",zs,a(i(t.value.raw?.free||0))+" ("+a(G.value)+"%)",1)])])])])]),_:1},8,["modelValue"]),r(n(F),{modelValue:U.value,"onUpdate:modelValue":s[1]||(s[1]=w=>U.value=w),title:"Szczegółowe informacje o pamięci",width:"700px"},{default:c(()=>[h.value?(g(),k("div",bs,[e("div",ks,[s[33]||(s[33]=e("h4",null,"Detale pamięci:",-1)),e("pre",null,a(JSON.stringify(h.value,null,2)),1)])])):(g(),k("div",Cs,[r(n(de),{class:"is-loading"},{default:c(()=>[r(n(ue))]),_:1}),s[34]||(s[34]=e("span",null,"Ładowanie szczegółowych danych...",-1))]))]),_:1},8,["modelValue"]),r(n(F),{modelValue:z.value,"onUpdate:modelValue":s[3]||(s[3]=w=>z.value=w),title:"Czyszczenie cache pamięci RAM",width:"400px"},{footer:c(()=>[e("span",Ms,[r(n(C),{onClick:s[2]||(s[2]=w=>z.value=!1)},{default:c(()=>s[38]||(s[38]=[f(" Anuluj ")])),_:1,__:[38]}),r(n(C),{type:"primary",onClick:se,loading:B.value},{default:c(()=>s[39]||(s[39]=[f(" Potwierdź ")])),_:1,__:[39]},8,["loading"])])]),default:c(()=>[e("div",xs,[s[37]||(s[37]=e("p",null,"Czy na pewno chcesz wyczyścić cache pamięci RAM?",-1)),e("div",Bs,[e("p",null,[s[35]||(s[35]=f("Aktualny cache: ")),e("strong",null,a(i(t.value.raw?.cached||0)),1)]),e("p",null,[s[36]||(s[36]=f("Buffers: ")),e("strong",null,a(i(t.value.raw?.buffers||0)),1)])]),x.value?(g(),K(n(ve),{key:0,title:x.value,type:"warning",closable:!1,"show-icon":"",class:"warning-alert"},null,8,["title"])):T("",!0)])]),_:1},8,["modelValue"])])}}}),Vs=te(Rs,[["__scopeId","data-v-43584a25"]]);export{Vs as default};

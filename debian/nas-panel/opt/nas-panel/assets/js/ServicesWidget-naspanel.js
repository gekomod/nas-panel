import{_ as W,u as q,r as h,c as I,o as L,W as M,b as C,A as P,B as Y,h as x,e as d,w as b,d as g,F,l as K,n as y,f as s,g as u,i as R,k as r,I as v,t as c,v as p}from"./index-naspanel.js";const U={class:"widget-header"},V={class:"header-main"},H={class:"header-icon"},O={class:"update-time"},Q={class:"header-sub"},Z={class:"system"},$={key:0,class:"widget-content"},j={class:"label"},G={class:"value"},X={class:"service-status"},J={key:1,class:"empty-state"},ee={name:"ServicesWidget",displayName:"Status usług"},te=Object.assign(ee,{setup(se){const{t:i}=q(),o=h([]),_=h(!0),m=h(i("common.loading"));let f=null;const l=h(new Set),z=I(()=>o.value.length===0?"info":o.value.some(t=>!t.active)?"warning":"success"),B=I(()=>{if(o.value.length===0)return i("services.noData");const e=o.value.filter(t=>!t.active).length;return e?`${e} NIEAKTYWNYCH`:"WSZYSTKIE AKTYWNE"}),D=e=>({nginx:"mdi:nginx",mysql:"mdi:database",postgresql:"mdi:database",docker:"mdi:docker",ssh:"mdi:lock",cron:"mdi:clock",smbd:"mdi:folder-network",nmbd:"mdi:folder-network",zfs:"mdi:harddisk",apache:"mdi:web",redis:"mdi:database",mongodb:"mdi:database",postfix:"mdi:email"})[e]||"mdi:cog",A=e=>({nginx:"NGINX",mysql:"MySQL",postgresql:"PostgreSQL",docker:"Docker",ssh:"SSH",cron:"Cron",smbd:"Samba",nmbd:"Samba NetBIOS",zfs:"ZFS",apache:"Apache",redis:"Redis",mongodb:"MongoDB",postfix:"Postfix"})[e]||e.charAt(0).toUpperCase()+e.slice(1),N=()=>{l.value.forEach(e=>{e.abort()}),l.value.clear()},E=async()=>{const e=new AbortController;l.value.add(e);try{return(await p.get("/system/settings",{signal:e.signal,timeout:3e3})).data.services?.monitoredServices||[]}catch(t){return p.isCancel(t)||console.error("Error fetching monitored services:",t),[]}finally{l.value.delete(e)}},T=async e=>{const t=new AbortController;l.value.add(t);try{const a=await p.get(`/services/status/${e}`,{signal:t.signal,timeout:2500});return{name:e,active:a.data.active,error:null}}catch(a){return p.isCancel(a)?{name:e,active:!1,error:"Przekroczono czas oczekiwania"}:{name:e,active:!1,error:a.response?.data?.error||"Błąd podczas sprawdzania statusu"}}finally{l.value.delete(t)}},k=async()=>{try{_.value=!0;const e=await E();if(e.length===0){o.value=[],m.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return}const t=[];for(let a=0;a<e.length;a+=2){const w=e.slice(a,a+2),S=await Promise.all(w.map(n=>T(n)));t.push(...S)}o.value=t,m.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){console.error("Error fetching services:",e),m.value=i("common.error"),o.value=[]}finally{_.value=!1}};return L(()=>{k(),f=setInterval(k,3e4)}),M(()=>{N(),f&&clearInterval(f)}),(e,t)=>{const a=C("el-tooltip"),w=C("el-card"),S=P("loading");return Y((d(),x(w,{class:"widget-card",shadow:"hover"},{header:b(()=>[s("div",U,[s("div",V,[s("div",H,[u(r(v),{icon:"mdi:server",width:"16"})]),t[0]||(t[0]=s("span",{class:"header-title"},"Status usług",-1)),s("div",O,[u(r(v),{icon:"mdi:update",width:"12"}),s("span",null,c(r(i)("common.update"))+": "+c(m.value),1)])]),s("div",Q,[s("span",{class:y(["hostname",z.value])},c(B.value),3),s("span",Z,c(o.value.length)+" usług",1)])])]),default:b(()=>[o.value.length>0?(d(),g("div",$,[(d(!0),g(F,null,K(o.value,n=>(d(),g("div",{key:n.name,class:y(["info-row service-item",{"warning-row":!n.active}])},[s("div",j,[u(r(v),{icon:D(n.name),width:"14"},null,8,["icon"]),s("span",null,c(A(n.name)),1),n.error?(d(),x(a,{key:0,content:n.error,placement:"top"},{default:b(()=>[u(r(v),{icon:"mdi:alert-circle",width:"12",class:"error-icon"})]),_:2},1032,["content"])):R("",!0)]),s("div",G,[s("div",X,[s("div",{class:y(["status-badge",n.active?"active":"inactive"])},c(n.active?r(i)("services.status.active"):r(i)("services.status.inactive")),3)])])],2))),128))])):(d(),g("div",J,[u(r(v),{icon:"mdi:information-outline",width:"16"}),s("span",null,c(r(i)("services.noData")),1)]))]),_:1})),[[S,_.value]])}}}),oe=W(te,[["__scopeId","data-v-71a70d4f"]]);export{oe as default};

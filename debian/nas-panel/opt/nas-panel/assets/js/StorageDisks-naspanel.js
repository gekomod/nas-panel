import{_ as le,u as re,r as f,v as A,c as L,o as O,H as ce,b as _,A as de,d as D,e as p,g as o,w as c,f as t,k as a,I as u,t as r,n as $,h as R,i as T,m as B,B as ue,E as C,x as M}from"./index-naspanel.js";import{u as ge}from"./useTheme-naspanel.js";const me={class:"storage-disks-dashboard"},_e={class:"header-content"},he={class:"header-left"},pe={class:"header-icon"},ve={class:"header-text"},fe={class:"subtitle"},ke={class:"header-stats"},be={class:"stat-item"},De={class:"stat-icon"},ye={class:"stat-info"},we={class:"stat-value"},Ce={class:"stat-label"},xe={class:"stat-item"},ze={class:"stat-icon"},Se={class:"stat-info"},$e={class:"stat-value"},Ie={class:"stat-label"},Ne={class:"stat-item"},Ae={class:"stat-icon"},Le={class:"stat-info"},Te={class:"stat-label"},Be={class:"stat-value"},Me={class:"header-actions"},Ue={class:"list-header"},Ve={class:"list-actions"},Ee={key:1,class:"loading-state"},je={key:2,class:"empty-state"},Fe={class:"empty-text"},Oe={key:3,class:"disks-table-container"},Re={class:"device-cell"},We={class:"device-name"},He={class:"model-cell"},Ke=["title"],Pe={class:"vendor-cell"},qe={key:0,class:"vendor-icon"},Ge={class:"vendor-name"},Je={class:"capacity-cell"},Qe={class:"serial-cell"},Xe={class:"serial-text"},Ye={class:"action-buttons"},Ze={key:0,class:"table-summary"},es={class:"summary-info"},ss={class:"summary-total"},ts={__name:"StorageDisks",setup(as){const{t:s}=re(),{isDarkMode:W}=ge(),g=f([]),h=f(!1),k=f(!1),y=f(null),w=f(""),I=f(null),v=f({prop:null,order:null});A.defaults.baseURL=`${window.location.protocol}//${window.location.hostname}:1112`;const U=L(()=>g.value.reduce((e,n)=>e+(n.size||0),0)),H=L(()=>{if(!I.value)return s("storageDisks.never");const e=new Date(I.value),i=Math.floor((new Date-e)/(1e3*60));return i<1?s("storageDisks.justNow"):i<60?s("storageDisks.minutesAgo",{minutes:i}):i<1440?s("storageDisks.hoursAgo",{hours:Math.floor(i/60)}):e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),V=L(()=>{let e=[...g.value];if(w.value){const n=w.value.toLowerCase();e=e.filter(i=>i.device?.toLowerCase().includes(n)||i.model?.toLowerCase().includes(n)||i.vendor?.toLowerCase().includes(n)||i.serial?.toLowerCase().includes(n))}return v.value.prop&&e.sort((n,i)=>{let d=n[v.value.prop],m=i[v.value.prop];return v.value.prop==="size"&&(d=Number(d)||0,m=Number(m)||0),d<m?v.value.order==="ascending"?-1:1:d>m?v.value.order==="ascending"?1:-1:0}),e}),K=e=>e?e.startsWith("nvme")?"mdi:memory":e.startsWith("sd")||e.startsWith("hd")?"mdi:harddisk":e.includes("ssd")?"mdi:memory":"mdi:harddisk":"mdi:help-circle-outline",P=e=>e.startsWith("nvme")||e.includes("ssd")?"ssd":"hdd",E=e=>{if(!e)return null;const n={Samsung:"simple-icons:samsung","Western Digital":"simple-icons:westerndigital",Seagate:"simple-icons:seagate",Toshiba:"simple-icons:toshiba",Intel:"simple-icons:intel",Kingston:"simple-icons:kingston",Crucial:"simple-icons:crucial",SanDisk:"simple-icons:sandisk",Micron:"simple-icons:micron",ADATA:"simple-icons:adata"};for(const i in n)if(e.toLowerCase().includes(i.toLowerCase()))return n[i];return null},x=(e,n=1)=>{if(e===0||e===void 0)return"0 B";if(typeof e!="number")return"Invalid";const i=1024,d=["B","KB","MB","GB","TB","PB"],m=Math.floor(Math.log(e)/Math.log(i)),S=m>=4?Math.max(0,n-1):n;return parseFloat((e/Math.pow(i,m)).toFixed(S))+" "+d[m]},q=e=>{if(!e)return"info";const n=e/(1024*1024*1024);return n<128?"info":n<512?"success":n<1024?"warning":"danger"},G=e=>!e||e.length<=12?e:e.substring(0,6)+"..."+e.substring(e.length-6),J=e=>{navigator.clipboard.writeText(e).then(()=>{M.success(s("storageDisks.copiedToClipboard"))}).catch(()=>{M.error(s("storageDisks.copyFailed"))})},z=async()=>{try{h.value=!0,y.value=null;const e=await A.get("/api/storage/disks",{timeout:1e4});let n=[];if(e.data?.data&&Array.isArray(e.data.data))n=e.data.data;else if(Array.isArray(e.data))n=e.data;else throw new Error("Invalid data format");g.value=n.map(i=>({device:i.device||"N/A",model:i.model||"N/A",serial:i.serial||"N/A",vendor:i.vendor||"N/A",size:parseInt(i.size)||0})),I.value=new Date().toISOString()}catch(e){y.value=e.response?.data?.message||s("storageDisks.errorLoading"),console.error("Error fetching disks:",e)}finally{h.value=!1}},Q=async()=>{await z(),C.success({title:s("storageDisks.refreshed"),message:s("storageDisks.refreshComplete"),position:"bottom-right",duration:3e3})},j=async()=>{try{k.value=!0,await A.post("/api/storage/rescan",{},{timeout:15e3}),await z(),C.success({title:s("storageDisks.scanSuccess"),message:s("storageDisks.scanComplete"),position:"bottom-right",duration:3e3})}catch(e){C.error({title:s("storageDisks.scanError"),message:e.response?.data?.message||e.message,position:"bottom-right",duration:5e3})}finally{k.value=!1}},X=e=>{C.info({title:s("storageDisks.diskDetails"),message:`
      <div style="line-height: 1.6; font-size: 13px;">
        <strong>${s("storageDisks.device")}:</strong> ${e.device}<br>
        <strong>${s("storageDisks.model")}:</strong> ${e.model}<br>
        <strong>${s("storageDisks.vendor")}:</strong> ${e.vendor}<br>
        <strong>${s("storageDisks.serial")}:</strong> ${e.serial}<br>
        <strong>${s("storageDisks.capacity")}:</strong> ${x(e.size)}
      </div>
    `,position:"bottom-right",duration:5e3,dangerouslyUseHTMLString:!0})},Y=e=>{C.warning({title:s("storageDisks.featureNotAvailable"),message:s("storageDisks.diskTestComingSoon"),position:"bottom-right",duration:4e3})},Z=()=>{const e=JSON.stringify(g.value,null,2),n=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(n),d=document.createElement("a");d.href=i,d.download=`disks-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(i),M.success(s("storageDisks.exportSuccess"))},ee=({prop:e,order:n})=>{v.value={prop:e,order:n==="ascending"?"ascending":"descending"}};O(()=>{z()});let N;return O(()=>{N=setInterval(z,3e4)}),ce(()=>{N&&clearInterval(N)}),(e,n)=>{const i=_("el-button"),d=_("el-tooltip"),m=_("el-button-group"),S=_("el-card"),se=_("el-input"),te=_("el-alert"),ae=_("el-icon"),b=_("el-table-column"),oe=_("el-tag"),ie=_("el-table"),ne=de("loading");return p(),D("div",me,[o(S,{class:"dashboard-header",shadow:"hover"},{default:c(()=>[t("div",_e,[t("div",he,[t("div",pe,[o(a(u),{icon:"mdi:harddisk"})]),t("div",ve,[t("h2",null,r(a(s)("storageDisks.title")),1),t("p",fe,r(a(s)("storageDisks.subtitle")),1)])]),t("div",ke,[t("div",be,[t("div",De,[o(a(u),{icon:"mdi:harddisk",width:"16"})]),t("div",ye,[t("div",we,r(g.value.length),1),t("div",Ce,r(a(s)("storageDisks.disksCount")),1)])]),t("div",xe,[t("div",ze,[o(a(u),{icon:"mdi:database",width:"16"})]),t("div",Se,[t("div",$e,r(x(U.value)),1),t("div",Ie,r(a(s)("storageDisks.totalCapacity")),1)])]),t("div",Ne,[t("div",Ae,[o(a(u),{icon:"mdi:update",width:"16"})]),t("div",Le,[t("div",Te,r(a(s)("storageDisks.lastUpdated")),1),t("div",Be,r(H.value),1)])])]),t("div",Me,[o(m,null,{default:c(()=>[o(d,{content:a(s)("storageDisks.refresh"),placement:"top"},{default:c(()=>[o(i,{onClick:Q,loading:h.value,disabled:k.value,size:"small",circle:""},{default:c(()=>[o(a(u),{icon:"mdi:refresh",width:"14",class:$({spin:h.value})},null,8,["class"])]),_:1},8,["loading","disabled"])]),_:1},8,["content"]),o(d,{content:a(s)("storageDisks.scanNew"),placement:"top"},{default:c(()=>[o(i,{onClick:j,loading:k.value,disabled:h.value,size:"small",circle:""},{default:c(()=>[o(a(u),{icon:"mdi:magnify-scan",width:"14",class:$({spin:k.value})},null,8,["class"])]),_:1},8,["loading","disabled"])]),_:1},8,["content"])]),_:1})])])]),_:1}),o(S,{class:"disks-list-card",shadow:"hover"},{default:c(()=>[t("div",Ue,[o(se,{modelValue:w.value,"onUpdate:modelValue":n[0]||(n[0]=l=>w.value=l),placeholder:a(s)("storageDisks.searchPlaceholder"),clearable:"",size:"small",class:"search-input",onClear:n[1]||(n[1]=l=>w.value="")},{prefix:c(()=>[o(a(u),{icon:"mdi:magnify",width:"14"})]),_:1},8,["modelValue","placeholder"]),t("div",Ve,[o(i,{size:"small",onClick:Z,disabled:g.value.length===0,class:"export-btn"},{default:c(()=>[o(a(u),{icon:"mdi:export",width:"14"}),B(" "+r(a(s)("storageDisks.export")),1)]),_:1},8,["disabled"])])]),y.value?(p(),R(te,{key:0,title:y.value,type:"error","show-icon":"",closable:"",onClose:n[2]||(n[2]=l=>y.value=""),size:"small",class:"compact-alert"},null,8,["title"])):T("",!0),h.value&&g.value.length===0?(p(),D("div",Ee,[o(ae,{size:20,class:"is-loading"},{default:c(()=>[o(a(u),{icon:"mdi:loading"})]),_:1}),t("span",null,r(a(s)("storageDisks.loading")),1)])):g.value.length===0&&!h.value?(p(),D("div",je,[o(a(u),{icon:"mdi:harddisk-remove",width:"48"}),t("div",Fe,[t("h4",null,r(a(s)("storageDisks.noDisksFound")),1),t("p",null,r(a(s)("storageDisks.noDisksDescription")),1),o(i,{type:"primary",size:"small",onClick:j,loading:k.value},{default:c(()=>[B(r(a(s)("storageDisks.scanForDisks")),1)]),_:1},8,["loading"])])])):(p(),D("div",Oe,[ue((p(),R(ie,{data:V.value,style:{width:"100%"},"empty-text":a(s)("storageDisks.noDisks"),class:$([{"dark-table":a(W)},"compact-table"]),onSortChange:ee},{default:c(()=>[o(b,{label:a(s)("storageDisks.device"),prop:"device",width:"120",sortable:""},{default:c(({row:l})=>[t("div",Re,[t("div",{class:$(["icon-wrapper",P(l.device)])},[o(a(u),{icon:K(l.device),width:"16"},null,8,["icon"])],2),t("span",We,r(l.device),1)])]),_:1},8,["label"]),o(b,{label:a(s)("storageDisks.model"),prop:"model","min-width":"180",sortable:""},{default:c(({row:l})=>[t("div",He,[t("span",{class:"truncate-text",title:l.model},r(l.model),9,Ke)])]),_:1},8,["label"]),o(b,{label:a(s)("storageDisks.vendor"),prop:"vendor",width:"150",sortable:""},{default:c(({row:l})=>[t("div",Pe,[E(l.vendor)?(p(),D("div",qe,[o(a(u),{icon:E(l.vendor),width:"16"},null,8,["icon"])])):T("",!0),t("span",Ge,r(l.vendor),1)])]),_:1},8,["label"]),o(b,{label:a(s)("storageDisks.capacity"),prop:"size",width:"120",sortable:""},{default:c(({row:l})=>[t("div",Je,[o(oe,{size:"small",type:q(l.size),effect:"plain",class:"capacity-tag"},{default:c(()=>[B(r(x(l.size)),1)]),_:2},1032,["type"])])]),_:1},8,["label"]),o(b,{label:a(s)("storageDisks.serial"),prop:"serial",width:"180"},{default:c(({row:l})=>[t("div",Qe,[o(d,{content:l.serial,placement:"top"},{default:c(()=>[t("span",Xe,r(G(l.serial)),1)]),_:2},1032,["content"]),o(i,{size:"small",text:"",onClick:F=>J(l.serial),class:"copy-btn"},{default:c(()=>[o(a(u),{icon:"mdi:content-copy",width:"12"})]),_:2},1032,["onClick"])])]),_:1},8,["label"]),o(b,{label:a(s)("storageDisks.actions"),width:"100",align:"right"},{default:c(({row:l})=>[t("div",Ye,[o(i,{size:"small",text:"",onClick:F=>X(l),class:"action-btn"},{default:c(()=>[o(a(u),{icon:"mdi:information-outline",width:"14"})]),_:2},1032,["onClick"]),o(i,{size:"small",text:"",onClick:F=>Y(l),class:"action-btn",disabled:h.value},{default:c(()=>[o(a(u),{icon:"mdi:speedometer",width:"14"})]),_:2},1032,["onClick","disabled"])])]),_:1},8,["label"])]),_:1},8,["data","empty-text","class"])),[[ne,h.value]]),g.value.length>0?(p(),D("div",Ze,[t("div",es,[t("span",null,r(a(s)("storageDisks.showing"))+" "+r(V.value.length)+"/"+r(g.value.length)+" "+r(a(s)("storageDisks.disks")),1),t("span",ss,r(a(s)("storageDisks.total"))+": "+r(x(U.value)),1)])])):T("",!0)]))]),_:1})])}}},ns=le(ts,[["__scopeId","data-v-e09151c9"]]);export{ns as default};

import{_ as Se,r as m,c as k,o as xe,H as Ae,D as se,b as p,A as $e,d as S,e as g,f as n,g as t,i as z,m as f,w as a,k as c,I as u,t as i,a3 as Le,B as Be,h as I,n as j,F as De,l as Ie,v as te,x,C as je,E as Ue}from"./index-naspanel.js";const Ne={class:"monitor-header"},Me={class:"header-left"},Te={class:"header-right"},Ve={class:"stats-cards"},Ee={class:"stat-content"},Re={class:"stat-info"},qe={class:"stat-value"},Fe={class:"stat-content"},Ze={class:"stat-info"},Oe={class:"stat-value"},He={class:"stat-content"},Ke={class:"stat-info"},Qe={class:"stat-value"},We={class:"stat-content"},Je={class:"stat-info"},Ge={class:"stat-value"},Xe={class:"table-header"},Ye={class:"table-controls"},es={class:"process-name"},ss={class:"name-text"},ts={class:"resource-cell"},as={class:"resource-value"},os={class:"resource-cell"},ns={class:"resource-value"},ls={class:"command-cell"},rs={class:"command-text"},is={class:"table-footer"},cs={class:"footer-info"},us={key:0,class:"info-item"},ds={key:1,class:"info-item"},ms={key:0,class:"process-details"},ps={class:"detail-name"},fs={class:"resource-detail"},vs={class:"detail-value"},gs={class:"resource-detail"},_s={class:"detail-value"},ys={class:"command-detail"},hs={class:"dialog-footer"},ws={key:0,class:"alerts-container"},bs={__name:"ProcessMonitor",setup(ks){const A=m(!1),ae=k(()=>A.value?"mdi:weather-sunny":"mdi:weather-night"),oe=()=>{A.value=!A.value,document.documentElement.classList.toggle("dark",A.value)},U=m(!1),v=m([]),$=m(""),L=m(!1),r=m({}),w=m(!0),N=m(null),M=m(""),y=m([]),T=m(null),_=m("cpu"),C=m("descending"),B=m(1),V=m(20),E=k(()=>{if(!$.value.trim())return v.value;const s=$.value.toLowerCase();return v.value.filter(e=>e.name.toLowerCase().includes(s)||e.pid.toString().includes(s)||e.user.toLowerCase().includes(s)||e.command.toLowerCase().includes(s))}),ne=k(()=>{const s=[...E.value];return _.value==="cpu"?s.sort((e,o)=>C.value==="descending"?o.cpu-e.cpu:e.cpu-o.cpu):_.value==="memory"?s.sort((e,o)=>C.value==="descending"?o.memory-e.memory:e.memory-o.memory):_.value==="pid"?s.sort((e,o)=>C.value==="descending"?o.pid-e.pid:e.pid-o.pid):s}),le=k(()=>{const s=(B.value-1)*V.value,e=s+V.value;return ne.value.slice(s,e)}),re=k(()=>v.value.filter(s=>s.cpu>70).length),ie=k(()=>v.value.filter(s=>s.memory>80).length),ce=k(()=>v.value.filter(s=>s.status&&(s.status.toLowerCase().includes("running")||s.status.toLowerCase().includes("r")||s.status==="R"||s.status==="S+")).length),H=s=>s>80?"#f56c6c":s>50?"#e6a23c":s>20?"#409eff":"#67c23a",K=s=>s>85?"#f56c6c":s>60?"#e6a23c":s>30?"#409eff":"#67c23a",Q=s=>{if(!s)return"info";const e=String(s).toLowerCase();return e.includes("running")||e==="r"||e==="r+"||e==="s+"?"success":e.includes("sleep")||e==="s"||e==="s "?"primary":e.includes("stop")||e==="t"||e.includes("trace")?"warning":e.includes("zombie")||e==="z"?"danger":"info"},W=s=>{if(!s)return"Nieznany";const e=String(s).toLowerCase();return e.includes("running")||e==="r"||e==="r+"?"Uruchomiony":e.includes("sleep")||e==="s"||e==="s+"||e==="s "?"Uśpiony":e.includes("stop")||e==="t"?"Zatrzymany":e.includes("zombie")||e==="z"?"Zombie":s},J=s=>{const e=(s||"").toLowerCase();return e.includes("node")||e.includes("npm")||e.includes("yarn")?"mdi:nodejs":e.includes("python")||e.includes("python3")?"mdi:language-python":e.includes("java")||e.includes("jar")?"mdi:language-java":e.includes("php")?"mdi:language-php":e.includes("docker")||e.includes("dockerd")?"mdi:docker":e.includes("nginx")?"mdi:nginx":e.includes("apache")||e.includes("httpd")?"mdi:web":e.includes("mysql")||e.includes("mariadb")||e.includes("redis")||e.includes("postgres")?"mdi:database":e.includes("bash")||e.includes("sh")?"mdi:console":e.includes("systemd")?"mdi:application-cog":e.includes("sshd")?"mdi:lock":e.includes("cron")?"mdi:clock":"mdi:cog"},G=s=>{const e=(s||"").toLowerCase();return e.includes("node")||e.includes("npm")||e.includes("yarn")?"icon-node":e.includes("python")?"icon-python":e.includes("java")?"icon-java":e.includes("docker")?"icon-docker":e.includes("nginx")||e.includes("apache")?"icon-web":e.includes("mysql")||e.includes("postgres")||e.includes("redis")?"icon-database":"icon-default"},ue=s=>{const e=(s||"").toLowerCase();return e.includes("node")?"Aplikacja Node.js":e.includes("python")?"Aplikacja Python":e.includes("java")?"Aplikacja Java":e.includes("docker")?"Proces Docker":e.includes("nginx")?"Serwer web Nginx":e.includes("apache")?"Serwer web Apache":e.includes("mysql")?"Baza danych MySQL":e.includes("postgres")?"Baza danych PostgreSQL":e.includes("redis")?"Baza danych Redis":e.includes("systemd")?"Systemd service":e.includes("sshd")?"SSH demon":"Proces systemowy"},de=s=>s?s.length<=60?s:s.substring(0,57)+"...":"",q=async()=>{try{U.value=!0,console.log("Pobieranie listy procesów...");const s=await te.get("/api/diagnostics/processes",{timeout:5e3,headers:{"Cache-Control":"no-cache"}});console.log("Odpowiedź API:",s.data);let e=[];if(Array.isArray(s.data))e=s.data;else if(s.data&&s.data.processes)e=s.data.processes;else if(s.data&&s.data.success&&s.data.processes)e=s.data.processes;else throw console.warn("Nieznany format odpowiedzi API:",s.data),new Error("Nieznany format odpowiedzi API");v.value=e.map(o=>({pid:parseInt(o.pid)||0,name:o.name||o.comm||"unknown",user:o.user||"unknown",cpu:parseFloat(o.cpu)||0,memory:parseFloat(o.memory)||0,status:o.status||o.stat||"unknown",command:o.command||o.args||"",protected:o.protected||o.user==="root"||parseInt(o.pid)<100||!1})),M.value=new Date().toLocaleTimeString("pl-PL"),me(),console.log(`Załadowano ${v.value.length} procesów`)}catch(s){console.error("Błąd ładowania procesów:",s),s.code==="ECONNABORTED"||s.message.includes("timeout")?x.warning("Timeout podczas ładowania procesów"):s.response?(console.error("Status:",s.response.status),console.error("Dane:",s.response.data),x.error(`Błąd API ${s.response.status}: ${s.response.data?.error||"Unknown error"}`)):x.error("Błąd ładowania procesów: "+s.message),v.value.length===0&&(v.value=pe(),x.warning("Używam danych testowych"))}finally{U.value=!1}},me=()=>{v.value.filter(e=>e.cpu>90||e.memory>95).forEach(e=>{y.value.some(d=>d.pid===e.pid)||y.value.push({id:`process-${e.pid}-${Date.now()}`,pid:e.pid,title:"Krytyczne zużycie zasobów",message:`Proces ${e.name} (PID: ${e.pid}) zużywa ${e.cpu}% CPU i ${e.memory}% pamięci`,type:"warning"})})},pe=()=>[{pid:1,name:"systemd",user:"root",cpu:.5,memory:.8,status:"S",command:"/usr/lib/systemd/systemd --switched-root --system --deserialize 22"},{pid:1234,name:"nginx",user:"www-data",cpu:15.2,memory:12.5,status:"S",command:"nginx: master process /usr/sbin/nginx -g daemon off;"},{pid:1235,name:"node",user:"app",cpu:45.7,memory:65.3,status:"R",command:"node /var/www/app/server.js"},{pid:1236,name:"python3",user:"app",cpu:5.2,memory:8.1,status:"S",command:"python3 /opt/app/main.py"},{pid:1237,name:"mysqld",user:"mysql",cpu:12.8,memory:32.4,status:"S",command:"/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid"},{pid:1238,name:"docker",user:"root",cpu:3.5,memory:15.7,status:"S",command:"/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock"},{pid:1239,name:"redis",user:"redis",cpu:.8,memory:5.2,status:"S",command:"/usr/bin/redis-server 127.0.0.1:6379"},{pid:1240,name:"sshd",user:"root",cpu:.2,memory:.5,status:"S",command:"/usr/sbin/sshd -D"},{pid:1241,name:"cron",user:"root",cpu:.1,memory:.3,status:"S",command:"/usr/sbin/cron -f"},{pid:1242,name:"php-fpm",user:"www-data",cpu:8.7,memory:18.9,status:"S",command:"php-fpm: pool www"}].map(e=>({...e,protected:e.user==="root"||e.pid<100,cpu:e.cpu,memory:e.memory,status:e.status})),F=()=>{q()},X=s=>{je.confirm(`Czy na pewno chcesz zakończyć proces ${s}?`,"Potwierdzenie zakończenia procesu",{confirmButtonText:"Zakończ",cancelButtonText:"Anuluj",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{T.value=s;try{const e=await te.post("/api/diagnostics/processes/kill",{pid:s},{timeout:1e4});console.log("Odpowiedź zakończenia procesu:",e.data);let o=`Proces ${s} został zakończony`;e.data&&e.data.message&&(o=e.data.message),x.success(o),v.value=v.value.filter(d=>d.pid!==s),y.value=y.value.filter(d=>d.pid!==s),r.value.pid===s&&(L.value=!1,r.value={}),setTimeout(()=>{q()},2e3)}catch(e){console.error("Błąd kończenia procesu:",e);let o="Błąd podczas kończenia procesu";e.response?.data?.message?o+=`: ${e.response.data.message}`:e.response?.data?.error?o+=`: ${e.response.data.error}`:e.message&&(o+=`: ${e.message}`),x.error(o)}finally{T.value=null}}).catch(()=>{console.log("Anulowano zakończenie procesu")})},fe=s=>{r.value=s,L.value=!0},ve=()=>{w.value=!w.value,w.value?ge():Z()},ge=()=>{Z(),N.value=setInterval(F,1e4),Ue({title:"Auto-refresh",message:"Automatyczne odświeżanie włączone (co 10s)",type:"success",duration:2e3})},Z=()=>{N.value&&(clearInterval(N.value),N.value=null)},_e=s=>{y.value=y.value.filter(e=>e.id!==s)},ye=({prop:s,order:e})=>{s&&(_.value=s,C.value=e==="ascending"?"ascending":"descending")};return xe(()=>{q(),M.value=new Date().toLocaleTimeString("pl-PL")}),Ae(()=>{Z()}),se($,()=>{B.value=1}),se(_,()=>{B.value=1}),(s,e)=>{const o=p("el-icon"),d=p("el-button"),he=p("el-input"),Y=p("el-button-group"),D=p("el-card"),P=p("el-tag"),h=p("el-table-column"),O=p("el-tooltip"),R=p("el-progress"),we=p("el-table"),be=p("el-pagination"),b=p("el-descriptions-item"),ke=p("el-descriptions"),ze=p("el-dialog"),Ce=p("el-alert"),Pe=$e("loading");return g(),S("div",{class:j(["process-monitor",{dark:A.value}])},[n("div",Ne,[n("div",Me,[n("h1",null,[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:chart-box"})]),_:1}),f(" "+i(s.$t("processMonitor.title")),1)]),e[8]||(e[8]=n("p",{class:"subtitle"},"Monitorowanie procesów systemowych",-1))]),n("div",Te,[t(Y,null,{default:a(()=>[t(d,{onClick:oe,icon:ae.value,circle:"",size:"large",class:"theme-toggle"},null,8,["icon"]),t(he,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=l=>$.value=l),placeholder:s.$t("processMonitor.searchPlaceholder"),clearable:"",class:"search-input",size:"large",onKeyup:Le(F,["enter"])},{prefix:a(()=>[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:magnify"})]),_:1})]),_:1},8,["modelValue","placeholder"]),t(d,{type:"primary",onClick:F,loading:U.value,size:"large"},{default:a(()=>[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:refresh"})]),_:1}),f(" "+i(s.$t("processMonitor.refresh")),1)]),_:1},8,["loading"]),t(d,{type:w.value?"warning":"default",onClick:ve,size:"large"},{default:a(()=>[t(o,null,{default:a(()=>[t(c(u),{icon:w.value?"mdi:pause":"mdi:play"},null,8,["icon"])]),_:1}),f(" "+i(w.value?"Pauza":"Auto"),1)]),_:1},8,["type"])]),_:1})])]),n("div",Ve,[t(D,{class:"stat-card"},{default:a(()=>[n("div",Ee,[t(o,{class:"stat-icon total"},{default:a(()=>[t(c(u),{icon:"mdi:server"})]),_:1}),n("div",Re,[n("div",qe,i(E.value.length),1),e[9]||(e[9]=n("div",{class:"stat-label"},"Procesy",-1))])])]),_:1}),t(D,{class:"stat-card"},{default:a(()=>[n("div",Fe,[t(o,{class:"stat-icon error"},{default:a(()=>[t(c(u),{icon:"mdi:cpu"})]),_:1}),n("div",Ze,[n("div",Oe,i(re.value),1),e[10]||(e[10]=n("div",{class:"stat-label"},"Wysokie CPU",-1))])])]),_:1}),t(D,{class:"stat-card"},{default:a(()=>[n("div",He,[t(o,{class:"stat-icon warning"},{default:a(()=>[t(c(u),{icon:"mdi:memory"})]),_:1}),n("div",Ke,[n("div",Qe,i(ie.value),1),e[11]||(e[11]=n("div",{class:"stat-label"},"Wysoka pamięć",-1))])])]),_:1}),t(D,{class:"stat-card"},{default:a(()=>[n("div",We,[t(o,{class:"stat-icon running"},{default:a(()=>[t(c(u),{icon:"mdi:check-circle"})]),_:1}),n("div",Je,[n("div",Ge,i(ce.value),1),e[12]||(e[12]=n("div",{class:"stat-label"},"Uruchomione",-1))])])]),_:1})]),t(D,{class:"process-table-card"},{default:a(()=>[n("div",Xe,[n("h3",null,[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:format-list-bulleted"})]),_:1}),e[13]||(e[13]=f(" Lista procesów ")),t(P,{size:"small",class:"table-count"},{default:a(()=>[f(i(E.value.length)+" z "+i(v.value.length),1)]),_:1})]),n("div",Ye,[t(d,{size:"small",onClick:e[1]||(e[1]=l=>{_.value="cpu",C.value="descending"}),type:_.value==="cpu"?"primary":"default"},{default:a(()=>[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:cpu"})]),_:1}),e[14]||(e[14]=f(" Sortuj CPU "))]),_:1,__:[14]},8,["type"]),t(d,{size:"small",onClick:e[2]||(e[2]=l=>{_.value="memory",C.value="descending"}),type:_.value==="memory"?"primary":"default"},{default:a(()=>[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:memory"})]),_:1}),e[15]||(e[15]=f(" Sortuj pamięć "))]),_:1,__:[15]},8,["type"])])]),Be((g(),I(we,{data:le.value,style:{width:"100%"},stripe:"",border:"",height:"calc(100vh - 320px)",onSortChange:ye,class:"process-table"},{default:a(()=>[t(h,{prop:"pid",label:"PID",width:"80",sortable:""}),t(h,{prop:"name",label:"Nazwa",width:"180",sortable:"","show-overflow-tooltip":""},{default:a(({row:l})=>[n("div",es,[t(O,{content:ue(l.name),placement:"top"},{default:a(()=>[t(o,{class:j(G(l.name))},{default:a(()=>[t(c(u),{icon:J(l.name)},null,8,["icon"])]),_:2},1032,["class"])]),_:2},1032,["content"]),n("span",ss,i(l.name),1)])]),_:1}),t(h,{prop:"user",label:"Użytkownik",width:"120",sortable:""},{default:a(({row:l})=>[t(P,{size:"small",type:l.user==="root"?"danger":"info",effect:"plain"},{default:a(()=>[f(i(l.user),1)]),_:2},1032,["type"])]),_:1}),t(h,{prop:"cpu",label:"CPU %",width:"120",sortable:""},{default:a(({row:l})=>[n("div",ts,[t(R,{percentage:l.cpu,color:H(l.cpu),"show-text":!1,"stroke-width":12,class:"resource-bar"},null,8,["percentage","color"]),n("div",as,[n("span",{class:j({"high-usage":l.cpu>70})},i(l.cpu.toFixed(1))+"%",3),l.cpu>70?(g(),I(o,{key:0,class:"warning-icon"},{default:a(()=>[t(c(u),{icon:"mdi:alert"})]),_:1})):z("",!0)])])]),_:1}),t(h,{prop:"memory",label:"Pamięć %",width:"130",sortable:""},{default:a(({row:l})=>[n("div",os,[t(R,{percentage:l.memory,color:K(l.memory),"show-text":!1,"stroke-width":12,class:"resource-bar"},null,8,["percentage","color"]),n("div",ns,[n("span",{class:j({"high-usage":l.memory>80})},i(l.memory.toFixed(1))+"%",3),l.memory>80?(g(),I(o,{key:0,class:"warning-icon"},{default:a(()=>[t(c(u),{icon:"mdi:alert"})]),_:1})):z("",!0)])])]),_:1}),t(h,{prop:"status",label:"Status",width:"100",sortable:""},{default:a(({row:l})=>[t(P,{type:Q(l.status),size:"small",effect:"light"},{default:a(()=>[f(i(W(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(h,{prop:"command",label:"Polecenie","show-overflow-tooltip":""},{default:a(({row:l})=>[n("div",ls,[n("code",rs,i(de(l.command)),1)])]),_:1}),t(h,{label:"Akcje",width:"140",fixed:"right"},{default:a(({row:l})=>[t(Y,null,{default:a(()=>[t(O,{content:"Szczegóły",placement:"top"},{default:a(()=>[t(d,{size:"small",type:"info",onClick:ee=>fe(l)},{default:a(()=>[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:information"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(O,{content:"Zakończ proces",placement:"top"},{default:a(()=>[t(d,{size:"small",type:"danger",onClick:ee=>X(l.pid),disabled:l.protected,loading:T.value===l.pid},{default:a(()=>[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:skull"})]),_:1})]),_:2},1032,["onClick","disabled","loading"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Pe,U.value]]),n("div",is,[n("div",cs,[M.value?(g(),S("div",us,[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:clock-outline"})]),_:1}),n("span",null,"Ostatnie odświeżenie: "+i(M.value),1)])):z("",!0),w.value?(g(),S("div",ds,[t(o,null,{default:a(()=>[t(c(u),{icon:"mdi:sync"})]),_:1}),e[16]||(e[16]=n("span",null,"Auto-refresh aktywny (co 10s)",-1))])):z("",!0)]),t(be,{"current-page":B.value,"onUpdate:currentPage":e[3]||(e[3]=l=>B.value=l),"page-size":V.value,"onUpdate:pageSize":e[4]||(e[4]=l=>V.value=l),total:E.value.length,"page-sizes":[20,50,100,200],layout:"total, sizes, prev, pager, next",small:"",background:"",class:"pagination"},null,8,["current-page","page-size","total"])])]),_:1}),t(ze,{modelValue:L.value,"onUpdate:modelValue":e[7]||(e[7]=l=>L.value=l),title:"Szczegóły procesu",width:"600px","close-on-click-modal":!1},{footer:a(()=>[n("div",hs,[r.value.pid?(g(),I(d,{key:0,type:"danger",onClick:e[5]||(e[5]=l=>X(r.value.pid)),disabled:r.value.protected,loading:T.value===r.value.pid},{default:a(()=>e[17]||(e[17]=[f(" Zakończ proces ")])),_:1,__:[17]},8,["disabled","loading"])):z("",!0),t(d,{onClick:e[6]||(e[6]=l=>L.value=!1)},{default:a(()=>e[18]||(e[18]=[f(" Zamknij ")])),_:1,__:[18]})])]),default:a(()=>[r.value.pid?(g(),S("div",ms,[t(ke,{column:1,border:""},{default:a(()=>[t(b,{label:"PID"},{default:a(()=>[n("strong",null,i(r.value.pid),1),t(P,{size:"small",type:r.value.protected?"danger":"success",class:"pid-tag"},{default:a(()=>[f(i(r.value.protected?"Chroniony":"Standardowy"),1)]),_:1},8,["type"])]),_:1}),t(b,{label:"Nazwa"},{default:a(()=>[n("div",ps,[t(o,{class:j(G(r.value.name))},{default:a(()=>[t(c(u),{icon:J(r.value.name)},null,8,["icon"])]),_:1},8,["class"]),n("span",null,i(r.value.name),1)])]),_:1}),t(b,{label:"Użytkownik"},{default:a(()=>[t(P,{size:"small",type:r.value.user==="root"?"danger":"info"},{default:a(()=>[f(i(r.value.user),1)]),_:1},8,["type"])]),_:1}),t(b,{label:"Status"},{default:a(()=>[t(P,{type:Q(r.value.status),size:"small"},{default:a(()=>[f(i(W(r.value.status)),1)]),_:1},8,["type"])]),_:1}),t(b,{label:"CPU"},{default:a(()=>[n("div",fs,[t(R,{percentage:r.value.cpu,color:H(r.value.cpu),"stroke-width":16,"text-inside":!0,class:"detail-progress"},null,8,["percentage","color"]),n("span",vs,i(r.value.cpu.toFixed(1))+"%",1)])]),_:1}),t(b,{label:"Pamięć"},{default:a(()=>[n("div",gs,[t(R,{percentage:r.value.memory,color:K(r.value.memory),"stroke-width":16,"text-inside":!0,class:"detail-progress"},null,8,["percentage","color"]),n("span",_s,i(r.value.memory.toFixed(1))+"%",1)])]),_:1}),t(b,{label:"Polecenie"},{default:a(()=>[n("pre",ys,i(r.value.command),1)]),_:1})]),_:1})])):z("",!0)]),_:1},8,["modelValue"]),y.value.length>0?(g(),S("div",ws,[(g(!0),S(De,null,Ie(y.value,l=>(g(),I(Ce,{key:l.id,title:l.title,type:l.type,closable:!0,"show-icon":"",onClose:ee=>_e(l.id),class:"critical-alert"},{default:a(()=>[f(i(l.message),1)]),_:2},1032,["title","type","onClose"]))),128))])):z("",!0)],2)}}},Cs=Se(bs,[["__scopeId","data-v-b3c2cff3"]]);export{Cs as default};

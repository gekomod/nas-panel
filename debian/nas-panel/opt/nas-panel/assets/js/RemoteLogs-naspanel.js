import{_ as re,r as _,c as N,D as de,o as ue,H as ce,b as c,d as v,e as p,g as l,w as o,f as t,k as d,I as u,t as m,m as a,i as b,F as pe,l as me,n as ve,h as W,v as U,x as C,z as ge}from"./index-naspanel.js";const fe={class:"remote-logs-dashboard"},_e={class:"header-content"},ye={class:"header-left"},we={class:"header-icon"},be={class:"header-text"},he={class:"card-header"},ze={class:"config-form"},ke={class:"switch-container"},Le={style:{display:"flex","align-items":"center",gap:"8px"}},Ce={style:{display:"flex","align-items":"center",gap:"8px"}},Ve={class:"form-actions"},xe={class:"card-header"},je={class:"card-header-actions"},$e={class:"log-controls"},Re={class:"search-controls"},Be={class:"action-controls"},Te={class:"log-content-wrapper"},Ue={key:0,class:"empty-state"},Se={key:0},Ie={key:1},De={key:1,class:"loading-spinner"},Ne={key:2,class:"log-entries"},Pe={class:"log-timestamp"},Ae={class:"log-level"},Fe={class:"log-message"},Ee={key:0,class:"log-source"},Oe={class:"log-text"},We={key:0,class:"log-footer"},Ke={key:0},qe={key:1},He={key:2},Me={__name:"RemoteLogs",setup(Je){const w=_(!1),V=_(!1),z=_([]),h=_(!1),x=_(null),j=_(200),$=_(null),n=_({enabled:!1,host:"",port:514,protocol:"udp"}),r=_({level:"all",search:""}),P=N(()=>z.value.length),K=N(()=>({all:"Wszystkie",error:"Błędy",warning:"Ostrzeżenia",info:"Informacje"})[r.value.level]),k=N(()=>{let s=[...z.value];if(r.value.level!=="all"&&(s=s.filter(e=>e.level.toLowerCase()===r.value.level)),r.value.search){const e=r.value.search.toLowerCase();s=s.filter(g=>g.message.toLowerCase().includes(e)||g.source&&g.source.toLowerCase().includes(e))}return s.slice(-j.value)}),R=async()=>{if(n.value.enabled){w.value=!0;try{const s=await U.get("/api/diagnostics/remote-logs",{params:{lines:j.value}});z.value=s.data.logs,A()}catch(s){console.error("Błąd pobierania zdalnych logów:",s),z.value=[],C.error("Nie można pobrać zdalnych logów")}finally{w.value=!1}}},q=async()=>{V.value=!0;try{await U.post("/api/diagnostics/remote-logs/config",n.value),C.success("Konfiguracja zapisana pomyślnie"),n.value.enabled?(await R(),h.value||S()):(B(),z.value=[])}catch{C.error("Błąd podczas zapisywania konfiguracji")}finally{V.value=!1}},H=()=>{n.value={enabled:!1,host:"",port:514,protocol:"udp"}},M=async()=>{try{const s=await U.get("/api/diagnostics/remote-logs/config");n.value=s.data.config,n.value.enabled&&(await R(),S())}catch(s){console.error("Błąd ładowania konfiguracji:",s)}},S=()=>{h.value=!h.value,h.value?J():B()},J=()=>{B(),x.value=setInterval(R,5e3)},B=()=>{x.value&&(clearInterval(x.value),x.value=null)},X=s=>{const e=s.level.toLowerCase();return e.includes("error")||e.includes("err")?"log-error":e.includes("warn")?"log-warning":e.includes("info")?"log-info":e.includes("debug")?"log-debug":""},Z=s=>{const e=s.toLowerCase();return e.includes("error")||e.includes("err")?"danger":e.includes("warn")?"warning":e.includes("info")?"info":e.includes("debug")?"":"info"},G=s=>s?new Date(s).toLocaleString("pl-PL"):"",A=()=>{ge(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)})},Q=async s=>{try{const e=await U.post("/api/diagnostics/remote-logs/export",{logs:k.value,format:s},{responseType:"blob"}),g=window.URL.createObjectURL(new Blob([e.data])),f=document.createElement("a");f.href=g,f.setAttribute("download",`logs-${new Date().toISOString().split("T")[0]}.${s}`),document.body.appendChild(f),f.click(),f.remove(),C.success(`Logi wyeksportowane jako ${s.toUpperCase()}`)}catch{C.error("Błąd podczas eksportowania logów")}};return de(r,()=>{A()},{deep:!0}),ue(async()=>{await M()}),ce(()=>{B()}),(s,e)=>{const g=c("el-card"),f=c("el-tag"),Y=c("el-switch"),I=c("el-text"),L=c("el-form-item"),F=c("el-input"),D=c("el-col"),E=c("el-input-number"),O=c("el-option"),ee=c("el-select"),le=c("el-row"),y=c("el-button"),oe=c("el-form"),se=c("el-button-group"),T=c("el-dropdown-item"),te=c("el-dropdown-menu"),ae=c("el-dropdown"),ne=c("el-icon");return p(),v("div",fe,[l(g,{class:"dashboard-header",shadow:"hover"},{default:o(()=>[t("div",_e,[t("div",ye,[t("div",we,[l(d(u),{icon:"mdi:server-network"})]),t("div",be,[t("h1",null,m(s.$t("systemLogs.remoteLogs")),1),e[9]||(e[9]=t("p",{class:"subtitle"},"Konfiguracja zdalnego wysyłania logów systemowych",-1))])])])]),_:1}),l(g,{class:"config-card",shadow:"hover"},{header:o(()=>[t("div",he,[t("h2",null,[l(d(u),{icon:"mdi:cog-outline"}),e[10]||(e[10]=a(" Konfiguracja Syslog "))]),l(f,{type:n.value.enabled?"success":"info",size:"small"},{default:o(()=>[a(m(n.value.enabled?"Aktywny":"Nieaktywny"),1)]),_:1},8,["type"])])]),default:o(()=>[t("div",ze,[l(oe,{model:n.value,"label-position":"top"},{default:o(()=>[l(L,{label:s.$t("systemLogs.enableRemote")},{default:o(()=>[t("div",ke,[l(Y,{modelValue:n.value.enabled,"onUpdate:modelValue":e[0]||(e[0]=i=>n.value.enabled=i),"active-text":s.$t("systemLogs.enableRemote"),size:"large"},null,8,["modelValue","active-text"]),l(I,{class:"switch-description",size:"small"},{default:o(()=>e[11]||(e[11]=[a(" Włącz wysyłanie logów systemowych na zdalny serwer Syslog ")])),_:1,__:[11]})])]),_:1},8,["label"]),l(le,{gutter:20},{default:o(()=>[l(D,{span:12},{default:o(()=>[l(L,{label:s.$t("systemLogs.host"),required:""},{default:o(()=>[l(F,{modelValue:n.value.host,"onUpdate:modelValue":e[1]||(e[1]=i=>n.value.host=i),placeholder:s.$t("systemLogs.host"),disabled:!n.value.enabled,size:"large"},{prefix:o(()=>[l(d(u),{icon:"mdi:server"})]),_:1},8,["modelValue","placeholder","disabled"])]),_:1},8,["label"])]),_:1}),l(D,{span:6},{default:o(()=>[l(L,{label:s.$t("systemLogs.port"),required:""},{default:o(()=>[l(E,{modelValue:n.value.port,"onUpdate:modelValue":e[2]||(e[2]=i=>n.value.port=i),min:1,max:65535,disabled:!n.value.enabled,"controls-position":"right",size:"large"},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1}),l(D,{span:6},{default:o(()=>[l(L,{label:s.$t("systemLogs.protocol")},{default:o(()=>[l(ee,{modelValue:n.value.protocol,"onUpdate:modelValue":e[3]||(e[3]=i=>n.value.protocol=i),disabled:!n.value.enabled,size:"large"},{default:o(()=>[l(O,{label:"UDP",value:"udp"},{default:o(()=>[t("div",Le,[l(d(u),{icon:"mdi:network-outline"}),e[12]||(e[12]=t("span",null,"UDP (szybszy, mniej niezawodny)",-1))])]),_:1}),l(O,{label:"TCP",value:"tcp"},{default:o(()=>[t("div",Ce,[l(d(u),{icon:"mdi:connection"}),e[13]||(e[13]=t("span",null,"TCP (wolniejszy, niezawodny)",-1))])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),l(L,null,{default:o(()=>[t("div",Ve,[l(y,{type:"primary",onClick:q,size:"large",loading:V.value},{default:o(()=>[l(d(u),{icon:"mdi:content-save"}),a(" "+m(s.$t("systemLogs.saveConfig")),1)]),_:1},8,["loading"]),l(y,{onClick:H,size:"large",disabled:V.value},{default:o(()=>[l(d(u),{icon:"mdi:restore"}),e[14]||(e[14]=a(" Resetuj "))]),_:1,__:[14]},8,["disabled"])])]),_:1})]),_:1},8,["model"])])]),_:1}),l(g,{class:"log-viewer-card",shadow:"hover"},{header:o(()=>[t("div",xe,[t("h2",null,[l(d(u),{icon:"mdi:file-document-multiple-outline"}),a(" "+m(s.$t("systemLogs.receivedLogs"))+" ",1),n.value.enabled?(p(),W(f,{key:0,type:"success",size:"small"},{default:o(()=>[a(m(P.value)+" logów ",1)]),_:1})):b("",!0)]),t("div",je,[l(se,null,{default:o(()=>[l(y,{type:r.value.level==="all"?"primary":"default",onClick:e[4]||(e[4]=i=>r.value.level="all"),size:"small"},{default:o(()=>e[15]||(e[15]=[a(" Wszystkie ")])),_:1,__:[15]},8,["type"]),l(y,{type:r.value.level==="error"?"danger":"default",onClick:e[5]||(e[5]=i=>r.value.level="error"),size:"small"},{default:o(()=>[l(d(u),{icon:"mdi:alert-circle"}),e[16]||(e[16]=a(" Błędy "))]),_:1,__:[16]},8,["type"]),l(y,{type:r.value.level==="warning"?"warning":"default",onClick:e[6]||(e[6]=i=>r.value.level="warning"),size:"small"},{default:o(()=>[l(d(u),{icon:"mdi:alert"}),e[17]||(e[17]=a(" Ostrzeżenia "))]),_:1,__:[17]},8,["type"])]),_:1})])])]),default:o(()=>[t("div",$e,[t("div",Re,[l(F,{modelValue:r.value.search,"onUpdate:modelValue":e[7]||(e[7]=i=>r.value.search=i),placeholder:"Szukaj w logach...",clearable:"",size:"large",style:{width:"300px"}},{prefix:o(()=>[l(d(u),{icon:"mdi:magnify"})]),_:1},8,["modelValue"]),l(E,{modelValue:j.value,"onUpdate:modelValue":e[8]||(e[8]=i=>j.value=i),min:50,max:5e3,step:50,size:"large",style:{width:"200px"},"controls-position":"right"},{prefix:o(()=>[l(d(u),{icon:"mdi:format-list-numbered"})]),append:o(()=>e[18]||(e[18]=[a(" linii ")])),_:1},8,["modelValue"])]),t("div",Be,[l(y,{type:"primary",onClick:R,loading:w.value,size:"large"},{default:o(()=>[l(d(u),{icon:"mdi:refresh"}),a(" "+m(s.$t("systemLogs.refresh")),1)]),_:1},8,["loading"]),l(y,{type:"info",onClick:S,loading:w.value,size:"large"},{default:o(()=>[l(d(u),{icon:h.value?"mdi:pause":"mdi:play"},null,8,["icon"]),a(" "+m(h.value?"Pauza":"Auto-odświeżanie"),1)]),_:1},8,["loading"]),l(ae,{onCommand:Q},{dropdown:o(()=>[l(te,null,{default:o(()=>[l(T,{command:"txt"},{default:o(()=>e[20]||(e[20]=[a("TXT")])),_:1,__:[20]}),l(T,{command:"csv"},{default:o(()=>e[21]||(e[21]=[a("CSV")])),_:1,__:[21]}),l(T,{command:"json"},{default:o(()=>e[22]||(e[22]=[a("JSON")])),_:1,__:[22]}),l(T,{divided:"",command:"pdf"},{default:o(()=>e[23]||(e[23]=[a("PDF")])),_:1,__:[23]})]),_:1})]),default:o(()=>[l(y,{type:"success",size:"large"},{default:o(()=>[l(d(u),{icon:"mdi:export"}),e[19]||(e[19]=a(" Eksportuj ")),l(d(u),{icon:"mdi:chevron-down"})]),_:1,__:[19]})]),_:1})])]),t("div",Te,[t("div",{class:"log-content",ref_key:"logContentRef",ref:$},[!w.value&&k.value.length===0?(p(),v("div",Ue,[l(d(u),{icon:"mdi:file-search-outline",width:"120",height:"120"}),e[24]||(e[24]=t("h3",null,"Brak logów",-1)),n.value.enabled?(p(),v("p",Se,"Serwer zdalny nie wysyła jeszcze logów")):(p(),v("p",Ie,"Zdalne logowanie jest wyłączone"))])):w.value?(p(),v("div",De,[l(ne,{size:48,class:"is-loading"},{default:o(()=>[l(d(u),{icon:"mdi:loading"})]),_:1}),e[25]||(e[25]=t("p",null,"Ładowanie logów...",-1))])):(p(),v("div",Ne,[(p(!0),v(pe,null,me(k.value,(i,ie)=>(p(),v("div",{key:ie,class:ve(["log-entry",X(i)])},[t("div",Pe,[l(d(u),{icon:"mdi:clock-outline"}),a(" "+m(G(i.timestamp)),1)]),t("div",Ae,[l(f,{type:Z(i.level),size:"small",effect:"plain"},{default:o(()=>[a(m(i.level),1)]),_:2},1032,["type"])]),t("div",Fe,[i.source?(p(),v("span",Ee,[t("strong",null,m(i.source)+":",1)])):b("",!0),t("span",Oe,m(i.message),1)])],2))),128))]))],512)]),!w.value&&k.value.length>0?(p(),v("div",We,[l(I,{type:"info",size:"small"},{default:o(()=>[a(" Wyświetlono "+m(k.value.length)+" z "+m(P.value)+" logów ",1)]),_:1}),r.value.level!=="all"||r.value.search?(p(),W(I,{key:0,type:"warning",size:"small"},{default:o(()=>[e[26]||(e[26]=a(" (Filtrowanie: ")),r.value.level!=="all"?(p(),v("span",Ke,m(K.value),1)):b("",!0),r.value.level!=="all"&&r.value.search?(p(),v("span",qe,", ")):b("",!0),r.value.search?(p(),v("span",He,'wyszukiwanie: "'+m(r.value.search)+'"',1)):b("",!0),e[27]||(e[27]=a(" ) "))]),_:1,__:[26,27]})):b("",!0)])):b("",!0)]),_:1})])}}},Ze=re(Me,[["__scopeId","data-v-7096cabd"]]);export{Ze as default};

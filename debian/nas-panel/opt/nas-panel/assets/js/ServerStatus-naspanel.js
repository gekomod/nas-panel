import{_ as q,y as A,a as F,r,c,o as G,H as J,b as Q,d,e as n,f as t,i as v,n as X,g as l,k as i,I as u,t as _,m as g,h as T,w as S,a5 as P}from"./index-naspanel.js";const Y={class:"server-status-container"},Z={class:"status-card"},ee={class:"status-header"},te={class:"status-title"},se={class:"status-message"},ae={key:0,class:"countdown-container"},oe={class:"countdown-circle"},re={class:"countdown-number"},ne={class:"countdown-svg",width:"120",height:"120"},le=["stroke-dasharray","stroke-dashoffset"],ie={key:1,class:"initiating-message"},ue={class:"initiating-box"},ce={key:2,class:"error-message"},de={class:"error-box"},ve={key:3,class:"status-countdown"},we={class:"countdown-text"},fe={class:"status-actions"},me={key:4,class:"status-info"},pe={class:"info-box"},ye={key:5,class:"success-message"},he={class:"success-box"},_e={__name:"ServerStatus",setup(ge){const j=A(),N=F(),s=r(!1),f=r(!1),I=r(!1),k=r(!1),w=r(180),m=r(5),p=r(null),y=r(null),h=r(null),b=r(!1),o=c(()=>j.params.type||"restart"),B=c(()=>o.value==="restart"&&!s.value),x=c(()=>2*Math.PI*54),M=c(()=>{const a=(180-w.value)/180;return x.value*(1-a)}),V=c(()=>s.value&&o.value==="restart"?"Serwer online!":o.value==="restart"?"Trwa restart serwera":"Serwer wyłączony"),D=c(()=>{if(s.value&&o.value==="restart")return"Restart został pomyślnie zakończony.";const a=Math.floor(w.value/60),e=w.value%60;return o.value==="restart"?`Przewidywany czas: ${a}m ${e}s`:"Serwer został bezpiecznie wyłączony."}),E=c(()=>({"status-offline":!s.value,"status-online":s.value})),H=c(()=>s.value?"mdi:check-circle":"mdi:progress-clock"),O=()=>{y.value=setInterval(()=>{w.value>0?w.value--:clearInterval(y.value)},1e3)},C=async()=>{if(!b.value){f.value=!0;try{const a=await P.checkStatus();s.value=a,a&&o.value==="restart"&&(console.log("Server is back online!"),clearInterval(p.value),U())}catch(a){console.log("Server status check:",a.message),k.value=!0,s.value=!1}finally{f.value=!1}}},$=async()=>{await C()},K=()=>{p.value=setInterval(()=>{C()},5e3)},L=async()=>{f.value=!0,I.value=!0,s.value=!1;try{const a=await P.restart();console.log("Restart result:",a),setTimeout(()=>{K(),O()},15e3)}catch(a){console.error("Restart error:",a),k.value=!0}finally{f.value=!1}},U=()=>{b.value=!0,h.value=setInterval(()=>{m.value--,m.value<=0&&(clearInterval(h.value),R())},1e3)},R=()=>{N.push("/login")},W=()=>{window.location.href="/"};return G(()=>{o.value==="restart"?setTimeout(()=>{L()},1e3):o.value==="shutdown"&&(s.value=!1)}),J(()=>{p.value&&clearInterval(p.value),y.value&&clearInterval(y.value),h.value&&clearInterval(h.value)}),(a,e)=>{const z=Q("el-button");return n(),d("div",Y,[e[12]||(e[12]=t("div",{class:"status-background"},[t("div",{class:"shape shape-1"}),t("div",{class:"shape shape-2"})],-1)),t("div",Z,[t("div",ee,[t("div",{class:X(["status-icon",E.value])},[l(i(u),{icon:H.value,width:"64"},null,8,["icon"])],2),t("h1",te,_(V.value),1),t("p",se,_(D.value),1)]),B.value&&!s.value?(n(),d("div",ae,[t("div",oe,[t("div",re,_(w.value),1),(n(),d("svg",ne,[e[0]||(e[0]=t("circle",{class:"countdown-circle-bg",cx:"60",cy:"60",r:"54"},null,-1)),t("circle",{class:"countdown-circle-progress",cx:"60",cy:"60",r:"54","stroke-dasharray":x.value,"stroke-dashoffset":M.value},null,8,le)]))]),e[1]||(e[1]=t("p",{class:"countdown-text"},"Przewidywany czas do zakończenia restartu",-1)),e[2]||(e[2]=t("p",{class:"checking-status"},"Sprawdzanie statusu serwera...",-1))])):v("",!0),I.value&&!s.value?(n(),d("div",ie,[t("div",ue,[l(i(u),{icon:"mdi:progress-upload",width:"24"}),e[3]||(e[3]=t("p",null,"Inicjowanie restartu serwera...",-1)),e[4]||(e[4]=t("p",null,"Proszę czekać, to może potrwać do 3 minut",-1))])])):v("",!0),k.value&&!s.value?(n(),d("div",ce,[t("div",de,[l(i(u),{icon:"mdi:alert-circle",width:"24"}),e[5]||(e[5]=t("p",null,"Nie można połączyć się z serwerem. Kontynuowanie prób...",-1))])])):v("",!0),m.value>0&&s.value?(n(),d("div",ve,[t("p",we,[l(i(u),{icon:"mdi:timer-outline",width:"20"}),g(" Przekierowanie na stronę logowania za: "+_(m.value)+"s ",1)])])):v("",!0),t("div",fe,[s.value?v("",!0):(n(),T(z,{key:0,type:"primary",onClick:$,loading:f.value,size:"large"},{default:S(()=>[l(i(u),{icon:"mdi:refresh",width:"20"}),e[6]||(e[6]=g(" Wymuś sprawdzenie statusu "))]),_:1,__:[6]},8,["loading"])),s.value?(n(),T(z,{key:1,onClick:R,size:"large"},{default:S(()=>[l(i(u),{icon:"mdi:login",width:"20"}),e[7]||(e[7]=g(" Przejdź do logowania "))]),_:1,__:[7]})):v("",!0),l(z,{onClick:W,size:"large",type:"text"},{default:S(()=>[l(i(u),{icon:"mdi:home",width:"20"}),e[8]||(e[8]=g(" Strona główna "))]),_:1,__:[8]})]),!s.value&&o.value==="restart"?(n(),d("div",me,[t("div",pe,[l(i(u),{icon:"mdi:information-outline",width:"24"}),e[9]||(e[9]=t("p",null,"Serwer jest w trakcie restartu. Prosimy o cierpliwość.",-1)),e[10]||(e[10]=t("p",null,"Typowy czas restartu: 1-3 minuty",-1))])])):v("",!0),s.value&&o.value==="restart"?(n(),d("div",ye,[t("div",he,[l(i(u),{icon:"mdi:check-circle",width:"24"}),e[11]||(e[11]=t("p",null,"Serwer jest już online! Możesz się zalogować.",-1))])])):v("",!0)])])}}},ze=q(_e,[["__scopeId","data-v-d2c2bc22"]]);export{ze as default};

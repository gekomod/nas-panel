import{_ as M,u as U,r as v,c as b,o as P,W as T,b as K,A as $,B as j,h as A,e as i,w as N,f as t,d as h,F as V,l as W,g as _,i as L,k as l,I as f,G as S,t as o,n as D,v as O}from"./index-naspanel.js";const E={class:"widget-header"},q={class:"header-main"},H={class:"header-icon"},J={class:"update-time"},Q={class:"header-sub"},R={class:"hostname"},X={class:"system"},Y={class:"widget-content"},Z={class:"disk-info"},ee={class:"disk-name"},te=["title"],se={class:"disk-stats"},ne={class:"disk-usage"},re={class:"usage-bar"},ae={class:"usage-numbers"},oe={class:"disk-size-info"},ce={class:"used-space"},ie={class:"total-space"},le={name:"FileSystemWidget",displayName:"Dyski"},de=Object.assign(le,{setup(ue){const{t:d}=U(),c=v([]),u=v(!0),m=v(d("common.loading"));let p=null;const I=b(()=>[...c.value].sort((e,s)=>s.percentNumber-e.percentNumber)),k=b(()=>{if(c.value.length===0)return 0;const e=c.value.reduce((s,a)=>s+a.percentNumber,0);return Math.round(e/c.value.length)}),z=e=>e.includes("nvme")?"ph:hard-drive":e.includes("sd")||e.includes("hd")?"ph:hard-drives":e.includes("mmc")?"mdi:sd-card":"mdi:harddisk",x=e=>e.includes("nvme")?"var(--el-color-primary)":e.includes("sd")?"var(--el-color-success)":e.includes("hd")?"var(--el-color-warning)":e.includes("mmc")?"var(--el-color-info)":"var(--el-text-color-secondary)",C=e=>e.replace(/^\/dev\//,"").toUpperCase(),F=e=>e?e.length>15&&e.split("/").pop()||e:"",g=e=>e>=90?"critical":e>=70?"warning":"normal",y=e=>{if(!e||e===0)return"0 B";const s=["B","KB","MB","GB","TB"];let a=e,n=0;for(;a>=1024&&n<s.length-1;)a/=1024,n++;return`${a.toFixed(n===0?0:1)} ${s[n]}`},B=e=>{if(!e)return 0;if(typeof e=="number")return e;const s={K:1,KB:1,M:2,MB:2,G:3,GB:3,T:4,TB:4,P:5,PB:5},a=e.toString().match(/^(\d+\.?\d*)\s*([KMGTP]?B?)$/i);if(a){const n=parseFloat(a[1]),r=a[2].toUpperCase();return n*Math.pow(1024,s[r]||0)}return parseFloat(e)||0},G=e=>B(e.size)*(e.percentNumber/100),w=async()=>{try{u.value=!0;const s=(await O.get("/api/filesystems")).data,a=Array.isArray(s)?s:s.disks||Object.values(s);c.value=a.map(n=>({device:n.device||"Unknown",size:n.size||"0B",percent:n.percent||"0%",percentNumber:parseInt(n.percent?.toString().replace("%",""))||0,mount:n.mount||""})).filter(n=>!["tmpfs","devtmpfs"].includes(n.device)),m.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){console.error("Błąd ładowania dysków:",e),m.value=d("common.error"),c.value=[{device:"/dev/sda1",size:"256GB",percent:"65%",percentNumber:65,mount:"/"},{device:"/dev/nvme0n1p1",size:"512GB",percent:"42%",percentNumber:42,mount:"/home"},{device:"/dev/mmcblk0p1",size:"128GB",percent:"18%",percentNumber:18,mount:"/boot"}]}finally{u.value=!1}};return P(()=>{w(),p=setInterval(w,3e4)}),T(()=>{p&&clearInterval(p)}),(e,s)=>{const a=K("el-card"),n=$("loading");return j((i(),A(a,{class:"widget-card",shadow:"hover"},{header:N(()=>[t("div",E,[t("div",q,[t("div",H,[_(l(f),{icon:"mdi:harddisk",width:"16"})]),s[0]||(s[0]=t("span",{class:"header-title"},"Dyski",-1)),t("div",J,[_(l(f),{icon:"mdi:update",width:"12"}),t("span",null,o(l(d)("common.update"))+": "+o(m.value),1)])]),t("div",Q,[t("span",R,o(c.value.length)+" dysków",1),t("span",X,o(k.value)+"% zajęte",1)])])]),default:N(()=>[t("div",Y,[(i(!0),h(V,null,W(I.value,r=>(i(),h("div",{key:r.device,class:"disk-row"},[t("div",Z,[_(l(f),{icon:z(r.device),width:"12",class:"disk-icon",style:S({color:x(r.device)})},null,8,["icon","style"]),t("span",ee,o(C(r.device)),1),r.mount?(i(),h("span",{key:0,class:"mount-point",title:r.mount},o(F(r.mount)),9,te)):L("",!0)]),t("div",se,[t("div",ne,[t("div",re,[t("div",{class:D(["bar-fill",g(r.percentNumber)]),style:S({width:`${r.percentNumber}%`})},null,6)]),t("div",ae,[t("span",{class:D(["usage-percent",g(r.percentNumber)])},o(r.percentNumber)+"% ",3)])]),t("div",oe,[t("span",ce,o(y(G(r))),1),s[1]||(s[1]=t("span",{class:"separator"},"/",-1)),t("span",ie,o(y(B(r.size))),1)])])]))),128))])]),_:1})),[[n,u.value]])}}}),pe=M(de,[["__scopeId","data-v-2f2224ae"]]);export{pe as default};

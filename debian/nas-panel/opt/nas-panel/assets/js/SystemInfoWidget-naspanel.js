import{_ as B,u as E,a as M,r as _,o as j,W as q,b as P,A as F,B as L,h as V,e as d,w as k,f as e,d as m,i as v,t as o,k as t,g as r,m as u,I as l,F as $,p as W,E as O}from"./index-naspanel.js";const A={class:"widget-header"},z={class:"header-main"},G={class:"header-icon"},H={class:"update-time"},J={class:"header-sub"},K={class:"hostname"},Q={class:"system"},X={class:"widget-content"},Y={class:"info-row"},Z={class:"label"},ee={class:"value"},te={class:"info-row"},se={class:"label"},oe={class:"value"},ae={class:"info-row"},ne={class:"label"},ie={class:"value"},re={class:"info-row"},le={class:"label"},ce={class:"value"},de={key:0,class:"info-row restart-row"},me={class:"label"},ue={class:"value"},he={key:1,class:"info-row"},pe={class:"label"},_e={class:"restart-dialog"},ve={class:"dialog-header"},fe={class:"dialog-body"},ye={class:"dialog-footer"},we={key:1,class:"restart-overlay"},ge={class:"restart-message"},Ie={class:"spinner"},be={name:"SystemInfoWidget",displayName:"Informacje o systemie"},ke=Object.assign(be,{setup($e){const{t:s}=E(),R=M(),n=_({system:{hostname:"",distro:"",kernel:"",time:"",uptime:0,requiresRestart:!1,pendingUpdates:0},cpu:{manufacturer:"",brand:""}}),f=_(s("common.loading")),h=_(!1),y=_(!1);let I=null,w=null;const g=_(!0),S=()=>{n.value.system.pendingUpdates>0&&R.push("/system/updates")},D=a=>{try{return new Date(a).toLocaleString("pl-PL",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return s("common.error")}},U=a=>{if(!a)return"00d 00h 00m";const i=Math.floor(a/86400),c=Math.floor(a%86400/3600),p=Math.floor(a%3600/60);return`${i}${s("common.daysShort")} ${c}${s("common.hoursShort")} ${p}${s("common.minutesShort")}`},b=async()=>{try{g.value=!0;const[a,i]=await Promise.all([fetch(`${window.location.protocol}//${window.location.hostname}:1112/api/system-info`),fetch(`${window.location.protocol}//${window.location.hostname}:1112/system/updates/check`)]);if(!a.ok||!i.ok)throw new Error("Failed to fetch system data");const[c,p]=await Promise.all([a.json(),i.json()]);c&&(n.value={...c,system:{...c.system,pendingUpdates:p.updates?.length||0}},f.value=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}catch(a){f.value=s("common.error"),console.error("Error fetching system info:",a),n.value.system.pendingUpdates=0}finally{g.value=!1,n.value.system.requiresRestart&&!localStorage.getItem("rebootReminder")&&setTimeout(()=>{h.value=!0},1e3)}},T=async()=>{h.value=!1,y.value=!0;try{if(!(await fetch(`${window.location.protocol}//${window.location.hostname}:1112/api/system-restart`,{method:"POST"})).ok)throw new Error("Restart failed");w=setTimeout(()=>{window.location.reload()},1e5);const i=async()=>{try{await fetch(`${window.location.protocol}//${window.location.hostname}:1112/api/system-health`),window.location.reload()}catch{setTimeout(i,1e3)}};setTimeout(i,5e3)}catch(a){console.error("Restart error:",a),y.value=!1,O.error({title:s("common.error"),message:s("systemInfo.restartFailed"),duration:5e3})}},C=()=>{const a=new Date(Date.now()+432e5);localStorage.setItem("rebootReminder",a),h.value=!1},N=()=>{const a=localStorage.getItem("rebootReminder");if(a){const i=new Date(a);new Date>i&&localStorage.removeItem("rebootReminder")}};return j(()=>{N(),b(),I=setInterval(b,3e4)}),q(()=>{clearInterval(I),w&&clearTimeout(w)}),(a,i)=>{const c=P("el-card"),p=F("loading");return L((d(),V(c,{class:"widget-card",shadow:"hover"},{header:k(()=>[e("div",A,[e("div",z,[e("div",G,[r(t(l),{icon:"mdi:information-outline",width:"16"})]),i[2]||(i[2]=e("span",{class:"header-title"},"Informacje o systemie",-1)),e("div",H,[r(t(l),{icon:"mdi:update",width:"12"}),e("span",null,o(t(s)("common.update"))+": "+o(f.value),1)])]),e("div",J,[e("span",K,o(n.value.system.hostname||t(s)("common.loading")),1),e("span",Q,o(n.value.system.distro||t(s)("common.loading")),1)])])]),default:k(()=>[e("div",X,[e("div",Y,[e("span",Z,o(t(s)("systemInfo.cpu")),1),e("span",ee,o(n.value.cpu.manufacturer+" "+n.value.cpu.brand||t(s)("common.loading")),1)]),e("div",te,[e("span",se,o(t(s)("systemInfo.system")),1),e("span",oe,o(n.value.system.kernel||t(s)("common.loading")),1)]),e("div",ae,[e("span",ne,o(t(s)("systemInfo.systemTime")),1),e("span",ie,o(n.value.system.time?D(n.value.system.time):t(s)("common.loading")),1)]),e("div",re,[e("span",le,o(t(s)("systemInfo.uptime")),1),e("span",ce,o(n.value.system.uptime?U(n.value.system.uptime):t(s)("common.loading")),1)]),n.value.system.requiresRestart?(d(),m("div",de,[e("span",me,[r(t(l),{icon:"mdi:alert-circle",width:"12"}),u(" "+o(t(s)("systemInfo.status"))+": ",1)]),e("span",ue,o(t(s)("systemInfo.restartRequired")),1)])):v("",!0),n.value.system.pendingUpdates>0?(d(),m("div",he,[e("span",pe,[r(t(l),{icon:n.value.system.pendingUpdates>0?"material-symbols-light:deployed-code-update-outline-sharp":"ic:round-update-disabled",width:"12"},null,8,["icon"]),u(" "+o(t(s)("systemInfo.pendingUpdates"))+": ",1)]),e("span",{class:"value update-available",onClick:i[0]||(i[0]=x=>n.value.system.pendingUpdates>0&&S())},[n.value.system.pendingUpdates>0?(d(),m($,{key:0},[r(t(l),{icon:"streamline-pixel:interface-essential-alert-circle-2",width:"12"}),u(" "+o(n.value.system.pendingUpdates),1)],64)):(d(),m($,{key:1},[u(o(t(s)("common.none")),1)],64))])])):v("",!0)]),h.value?(d(),m("div",{key:0,class:"restart-dialog-overlay",onClick:i[1]||(i[1]=W(x=>h.value=!1,["self"]))},[e("div",_e,[e("div",ve,[r(t(l),{icon:"mdi:alert-circle",width:"20"}),e("h3",null,o(t(s)("systemInfo.restartRequired")),1)]),e("div",fe,[e("p",null,o(t(s)("systemInfo.restartDialogMessage")),1)]),e("div",ye,[e("button",{class:"btn later",onClick:C},[r(t(l),{icon:"mdi:clock-outline",width:"14"}),u(" "+o(t(s)("systemInfo.restartLater")),1)]),e("button",{class:"btn now",onClick:T},[r(t(l),{icon:"mdi:restart",width:"14"}),u(" "+o(t(s)("systemInfo.restartNow")),1)])])])])):v("",!0),y.value?(d(),m("div",we,[e("div",ge,[e("div",Ie,[r(t(l),{icon:"mdi:restart",width:"36",class:"spinning"})]),e("h3",null,o(t(s)("systemInfo.restartInProgress")),1),e("p",null,o(t(s)("systemInfo.restartDescription")),1)])])):v("",!0)]),_:1})),[[p,g.value]])}}}),Se=B(ke,[["__scopeId","data-v-d5ab25db"]]);export{Se as default};

import{_ as $e,u as Be,r as d,o as Te,a as k,b as m,e as a,w as o,h as r,m as ee,F as _,k as h,l as b,t as p,v as Ue,d as $,x as De,f as O,j as A,I as P,g as xe,y as g,z as c,B as le}from"./index-BdZFAIpY.js";const Ce={class:"backup-container"},ze={class:"card-header"},Se={style:{float:"left"}},Me={style:{float:"right",color:"var(--el-text-color-secondary)"}},He={class:"pagination"},Ne={__name:"Backup",setup(Fe){const{t:u}=Be(),G=l=>new Date(l).toLocaleString(),C=l=>{if(l===0)return"0 Bytes";const t=1024,v=["Bytes","KB","MB","GB","TB"],i=Math.floor(Math.log(l)/Math.log(t));return parseFloat((l/Math.pow(t,i)).toFixed(2))+" "+v[i]},y=d({type:"full",name:"",items:[],compression:"medium",includeSystemConfig:!0}),z=d(!1),T=d(!1),K=d(""),J=d(""),ae=[{value:"full",text:u("backup.types.full")},{value:"incremental",text:u("backup.types.incremental")},{value:"differential",text:u("backup.types.differential")}],te=[{value:"documents",text:u("backup.items.documents")},{value:"photos",text:u("backup.items.photos")},{value:"music",text:u("backup.items.music")},{value:"videos",text:u("backup.items.videos")},{value:"configuration",text:u("backup.items.configuration")}],oe=[{value:"none",text:u("backup.compression_levels.none")},{value:"low",text:u("backup.compression_levels.low")},{value:"medium",text:u("backup.compression_levels.medium")},{value:"high",text:u("backup.compression_levels.high")}],ue=async()=>{z.value=!0;try{const l=await g.post("/api/system/backup/create",y.value);K.value=u("backup.success_title"),J.value=u("backup.success_message",{name:l.data.backup.name,size:C(l.data.backup.size)}),T.value=!0,D()}catch(l){c.error(l.response?.data?.message||u("backup.error_message"))}finally{z.value=!1}},Q=d([]),U=d(""),S=d(!1),M=d(!0),H=d(!1),N=d(!1),se=async()=>{N.value=!0;try{const l=await g.get("/api/system/backup/list");Q.value=l.data.backups}catch{c.error(u("backup.fetch_error"))}finally{N.value=!1}},ne=async()=>{try{await le.confirm(u("backup.restore_confirm"),u("common.warning"),{type:"warning"}),H.value=!0;const l=await g.post("/api/system/backup/restore",{backup_id:U.value,restore_system_config:S.value,verify_integrity:M.value});c.success(u("backup.restore_success"))}catch(l){l!=="cancel"&&c.error(l.response?.data?.message||u("backup.restore_error"))}finally{H.value=!1}},W=d([]),F=d(!1),L=d(1),q=d(10),X=d(0),D=async()=>{F.value=!0;try{const l=await g.get("/api/system/backup/history",{params:{page:L.value,per_page:q.value}});W.value=l.data.backups,X.value=l.data.total}catch{c.error(u("backup.history_fetch_error"))}finally{F.value=!1}},de=async l=>{try{const t=await g({method:"get",url:`/api/system/backup/download/${l}`,responseType:"blob"}),v=window.URL.createObjectURL(new Blob([t.data])),i=document.createElement("a");i.href=v;const f=t.headers["content-disposition"];let n=`backup-${l}.tar.gz`;if(f){const B=f.match(/filename="?(.+)"?/);B&&B[1]&&(n=B[1])}i.setAttribute("download",n),document.body.appendChild(i),i.click(),setTimeout(()=>{window.URL.revokeObjectURL(v),i.remove()},100),c.success("Backup download started")}catch(t){if(t.response)if(t.response.status===404)c.error("Backup not found on server");else if(t.response.status===423)c.warning("Backup is not ready for download yet");else{const v=t.response.data?.error||t.response.statusText||"Download failed";c.error(v)}else t.request?c.error("No response from server. Check your connection."):c.error(t.message||"Failed to download backup")}},re=async l=>{try{await le.confirm(u("backup.delete_confirm"),u("common.warning"),{type:"warning"}),await g.delete(`/api/system/backup/delete/${l}`),c.success(u("backup.delete_success")),D()}catch(t){t!=="cancel"&&c.error(u("backup.delete_error"))}},ie=l=>({completed:"success",failed:"danger",in_progress:"warning",queued:"info"})[l]||"",s=d({type:"disabled",dailyTime:"02:00",weeklyDay:"monday",weeklyTime:"02:00",monthlyDay:1,monthlyTime:"02:00",retention:"30d"}),I=d(!1),pe=[{value:"disabled",text:u("backup.schedule_types.disabled")},{value:"daily",text:u("backup.schedule_types.daily")},{value:"weekly",text:u("backup.schedule_types.weekly")},{value:"monthly",text:u("backup.schedule_types.monthly")}],ce=[{value:"monday",text:u("weekdays.monday")},{value:"tuesday",text:u("weekdays.tuesday")},{value:"wednesday",text:u("weekdays.wednesday")},{value:"thursday",text:u("weekdays.thursday")},{value:"friday",text:u("weekdays.friday")},{value:"saturday",text:u("weekdays.saturday")},{value:"sunday",text:u("weekdays.sunday")}],me=[{value:"7d",text:u("backup.retention_options.7d")},{value:"14d",text:u("backup.retention_options.14d")},{value:"30d",text:u("backup.retention_options.30d")},{value:"90d",text:u("backup.retention_options.90d")},{value:"1y",text:u("backup.retention_options.1y")},{value:"forever",text:u("backup.retention_options.forever")}],ye=async()=>{try{const l=await g.get("/api/system/backup/schedule");l.data.schedule&&(s.value={type:l.data.schedule.type||"disabled",dailyTime:l.data.schedule.daily_time||"02:00",weeklyDay:l.data.schedule.weekly_day||"monday",weeklyTime:l.data.schedule.weekly_time||"02:00",monthlyDay:l.data.schedule.monthly_day||1,monthlyTime:l.data.schedule.monthly_time||"02:00",retention:l.data.schedule.retention||"30d"})}catch{c.error(u("backup.schedule_load_error"))}},be=async()=>{I.value=!0;try{const l={schedule:{type:s.value.type,retention:s.value.retention}};s.value.type==="daily"?l.schedule.daily_time=s.value.dailyTime:s.value.type==="weekly"?(l.schedule.weekly_day=s.value.weeklyDay,l.schedule.weekly_time=s.value.weeklyTime):s.value.type==="monthly"&&(l.schedule.monthly_day=s.value.monthlyDay,l.schedule.monthly_time=s.value.monthlyTime),await g.post("/api/system/backup/schedule",l),c.success(u("backup.schedule_saved"))}catch(l){const t=l.response?.data?.error||l.response?.data?.message||u("backup.schedule_save_error");c.error(t)}finally{I.value=!1}},Y=d("create");return Te(()=>{se(),D(),ye()}),(l,t)=>{const v=r("el-icon"),i=r("el-option"),f=r("el-select"),n=r("el-form-item"),B=r("el-input"),R=r("el-checkbox"),w=r("el-button"),E=r("el-form"),x=r("el-tab-pane"),V=r("el-table-column"),Z=r("el-tag"),ve=r("el-table"),fe=r("el-pagination"),j=r("el-time-picker"),ke=r("el-input-number"),_e=r("el-tabs"),ge=r("el-dialog"),he=r("el-card"),we=De("loading");return m(),k("div",Ce,[a(he,{shadow:"hover"},{header:o(()=>[$("div",ze,[a(v,{size:"24"},{default:o(()=>[a(A(P),{icon:"mdi:content-save"})]),_:1}),$("span",null,p(l.$t("backup.title")),1)])]),default:o(()=>[a(_e,{modelValue:Y.value,"onUpdate:modelValue":t[17]||(t[17]=e=>Y.value=e),class:"backup-tabs"},{default:o(()=>[a(x,{label:l.$t("backup.create"),name:"create"},{default:o(()=>[a(E,{model:y.value,"label-position":"top",onSubmit:ee(ue,["prevent"])},{default:o(()=>[a(n,{label:l.$t("backup.type"),required:""},{default:o(()=>[a(f,{modelValue:y.value.type,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value.type=e)},{default:o(()=>[(m(),k(_,null,h(ae,e=>a(i,{key:e.value,label:e.text,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,{label:l.$t("backup.name"),required:""},{default:o(()=>[a(B,{modelValue:y.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value.name=e)},null,8,["modelValue"])]),_:1},8,["label"]),a(n,{label:l.$t("backup.items")},{default:o(()=>[a(f,{modelValue:y.value.items,"onUpdate:modelValue":t[2]||(t[2]=e=>y.value.items=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:o(()=>[(m(),k(_,null,h(te,e=>a(i,{key:e.value,label:e.text,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,{label:l.$t("backup.compression")},{default:o(()=>[a(f,{modelValue:y.value.compression,"onUpdate:modelValue":t[3]||(t[3]=e=>y.value.compression=e)},{default:o(()=>[(m(),k(_,null,h(oe,e=>a(i,{key:e.value,label:e.text,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,null,{default:o(()=>[a(R,{modelValue:y.value.includeSystemConfig,"onUpdate:modelValue":t[4]||(t[4]=e=>y.value.includeSystemConfig=e)},{default:o(()=>[b(p(l.$t("backup.include_system_config")),1)]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:o(()=>[a(w,{type:"primary","native-type":"submit",loading:z.value},{default:o(()=>[b(p(l.$t("backup.create_button")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["label"]),a(x,{label:l.$t("backup.restore"),name:"restore"},{default:o(()=>[a(E,{"label-position":"top"},{default:o(()=>[a(n,{label:l.$t("backup.select_backup"),required:""},{default:o(()=>[a(f,{modelValue:U.value,"onUpdate:modelValue":t[5]||(t[5]=e=>U.value=e),filterable:"",loading:N.value},{default:o(()=>[(m(!0),k(_,null,h(Q.value,e=>(m(),O(i,{key:e.id,label:e.name,value:e.id,disabled:e.status!=="completed"},{default:o(()=>[$("span",Se,p(e.name),1),$("span",Me,p(G(e.created_at))+" ("+p(C(e.size))+") ",1)]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading"])]),_:1},8,["label"]),a(n,null,{default:o(()=>[a(R,{modelValue:S.value,"onUpdate:modelValue":t[6]||(t[6]=e=>S.value=e)},{default:o(()=>[b(p(l.$t("backup.restore_system_config")),1)]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:o(()=>[a(R,{modelValue:M.value,"onUpdate:modelValue":t[7]||(t[7]=e=>M.value=e)},{default:o(()=>[b(p(l.$t("backup.verify_integrity")),1)]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:o(()=>[a(w,{type:"primary",onClick:ne,loading:H.value,disabled:!U.value},{default:o(()=>[b(p(l.$t("backup.restore_button")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["label"]),a(x,{label:l.$t("backup.history"),name:"history"},{default:o(()=>[Ue((m(),O(ve,{data:W.value,"empty-text":"No backups available",style:{width:"100%"}},{default:o(()=>[a(V,{prop:"name",label:l.$t("backup.history_table.name")},null,8,["label"]),a(V,{label:l.$t("backup.history_table.type")},{default:o(({row:e})=>[a(Z,null,{default:o(()=>[b(p(l.$t(`backup.types.${e.type}`)),1)]),_:2},1024)]),_:1},8,["label"]),a(V,{label:l.$t("backup.history_table.date")},{default:o(({row:e})=>[b(p(G(e.created_at)),1)]),_:1},8,["label"]),a(V,{label:l.$t("backup.history_table.size")},{default:o(({row:e})=>[b(p(C(e.size)),1)]),_:1},8,["label"]),a(V,{label:l.$t("backup.history_table.status")},{default:o(({row:e})=>[a(Z,{type:ie(e.status)},{default:o(()=>[b(p(l.$t(`backup.statuses.${e.status}`)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(V,{label:l.$t("backup.history_table.actions"),width:"180"},{default:o(({row:e})=>[a(w,{size:"small",onClick:Ve=>de(e.id),disabled:e.status!=="completed"},{default:o(()=>[a(v,null,{default:o(()=>[a(A(P),{icon:"mdi:download"})]),_:1})]),_:2},1032,["onClick","disabled"]),a(w,{size:"small",type:"danger",onClick:Ve=>re(e.id)},{default:o(()=>[a(v,null,{default:o(()=>[a(A(P),{icon:"mdi:delete"})]),_:1})]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[we,F.value]]),$("div",He,[a(fe,{"current-page":L.value,"onUpdate:currentPage":t[8]||(t[8]=e=>L.value=e),"page-size":q.value,"onUpdate:pageSize":t[9]||(t[9]=e=>q.value=e),total:X.value,onCurrentChange:D,layout:"prev, pager, next"},null,8,["current-page","page-size","total"])])]),_:1},8,["label"]),a(x,{label:l.$t("backup.schedule"),name:"schedule"},{default:o(()=>[a(E,{model:s.value,"label-position":"top",onSubmit:ee(be,["prevent"])},{default:o(()=>[a(n,{label:l.$t("backup.schedule_type")},{default:o(()=>[a(f,{modelValue:s.value.type,"onUpdate:modelValue":t[10]||(t[10]=e=>s.value.type=e)},{default:o(()=>[(m(),k(_,null,h(pe,e=>a(i,{key:e.value,label:e.text,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s.value.type==="daily"?(m(),O(n,{key:0,label:l.$t("backup.daily_time")},{default:o(()=>[a(j,{modelValue:s.value.dailyTime,"onUpdate:modelValue":t[11]||(t[11]=e=>s.value.dailyTime=e),format:"HH:mm","value-format":"HH:mm"},null,8,["modelValue"])]),_:1},8,["label"])):s.value.type==="weekly"?(m(),k(_,{key:1},[a(n,{label:l.$t("backup.weekly_day")},{default:o(()=>[a(f,{modelValue:s.value.weeklyDay,"onUpdate:modelValue":t[12]||(t[12]=e=>s.value.weeklyDay=e)},{default:o(()=>[(m(),k(_,null,h(ce,e=>a(i,{key:e.value,label:e.text,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,{label:l.$t("backup.weekly_time")},{default:o(()=>[a(j,{modelValue:s.value.weeklyTime,"onUpdate:modelValue":t[13]||(t[13]=e=>s.value.weeklyTime=e),format:"HH:mm","value-format":"HH:mm"},null,8,["modelValue"])]),_:1},8,["label"])],64)):s.value.type==="monthly"?(m(),k(_,{key:2},[a(n,{label:l.$t("backup.monthly_day")},{default:o(()=>[a(ke,{modelValue:s.value.monthlyDay,"onUpdate:modelValue":t[14]||(t[14]=e=>s.value.monthlyDay=e),min:1,max:31},null,8,["modelValue"])]),_:1},8,["label"]),a(n,{label:l.$t("backup.monthly_time")},{default:o(()=>[a(j,{modelValue:s.value.monthlyTime,"onUpdate:modelValue":t[15]||(t[15]=e=>s.value.monthlyTime=e),format:"HH:mm","value-format":"HH:mm"},null,8,["modelValue"])]),_:1},8,["label"])],64)):xe("",!0),a(n,{label:l.$t("backup.retention")},{default:o(()=>[a(f,{modelValue:s.value.retention,"onUpdate:modelValue":t[16]||(t[16]=e=>s.value.retention=e)},{default:o(()=>[(m(),k(_,null,h(me,e=>a(i,{key:e.value,label:e.text,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(n,null,{default:o(()=>[a(w,{type:"primary","native-type":"submit",loading:I.value},{default:o(()=>[b(p(l.$t("backup.save_schedule")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["label"])]),_:1},8,["modelValue"]),a(ge,{modelValue:T.value,"onUpdate:modelValue":t[19]||(t[19]=e=>T.value=e),title:K.value},{footer:o(()=>[a(w,{onClick:t[18]||(t[18]=e=>T.value=!1)},{default:o(()=>[b(p(l.$t("common.close")),1)]),_:1})]),default:o(()=>[$("p",null,p(J.value),1)]),_:1},8,["modelValue","title"])]),_:1})])}}},qe=$e(Ne,[["__scopeId","data-v-efe7e46a"]]);export{qe as default};
